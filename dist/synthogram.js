/*! synthogram - v0.3.0 - 2013-12-09
* Copyright (c) 2013 ; Licensed  */
function Note(a){this.coord=a}function Interval(a){this.coord=a}function add_addsubtract_func(a){return a.add=function(a){var b,c=[];for(b in this)"object"==typeof this[b]&&(c[b]=this[b].add(a));return add_addsubtract_func(c),c},a.subtract=function(a){var b,c=[];for(b in this)"object"==typeof this[b]&&(c[b]=this[b].subtract(a));return add_addsubtract_func(c),c},a}function sgModel(){function a(a,b,c){this.name=a,this.value=b,this.changeListeners=c}function b(b){this.properties=b;for(var c in b){var d=b[c];this.properties[c]=new a(c,d,[])}}function c(){var a=new b({stepsPerSecond:40,volume:.5,numOscillators:80,startFrequency:55,delayTime:.125,delayFeedbackGain:.25,delayWetGain:.3,startNote:"C",startNoteKey:"C",startNoteAccidental:"",startOctave:4,musicalScale:"major",numOctaves:2,waveShape:"sine",isPlaying:!1,isSynthPlaying:!1,currentStep:0,isMuted:!1});a.get("isSynthPlaying").addChangeListener(function(b){a.get("isPlaying").set(b)}),a.get("startNoteKey").addChangeListener(function(){a.get("startNote").set(a.getVal("startNoteKey")+a.getVal("startNoteAccidental"))}),a.get("startNoteAccidental").addChangeListener(function(){a.get("startNote").set(a.getVal("startNoteKey")+a.getVal("startNoteAccidental"))}),a.get("startNote").addChangeListener(function(b){a.setVal("startNoteKey",b[0]),b.length>1&&a.setVal("startNoteAccidental",b[1])});var c=.5;return a.get("isMuted").addChangeListener(function(b){if(b){var d=a.getVal("volume");0!==d&&(c=d,a.setVal("volume",0))}else 0===a.getVal("volume")&&a.setVal("volume",c)}),a.get("volume").addChangeListener(function(b){0===b?a.setVal("isMuted",!0):a.setVal("isMuted",!1)}),a}return a.prototype.set=function(a){if(a!==this.value){this.value=a;for(var b=this.changeListeners,c=0;c<b.length;c++)b[c].call(this,this.value)}},a.prototype.get=function(){return this.value},a.prototype.addChangeListener=function(a){this.changeListeners.push(a)},b.prototype.get=function(a){if(!this.exists(a))throw new Error('property "'+a+'" is not in model.');return this.properties[a]},b.prototype.setVal=function(a,b){this.get(a).set(b)},b.prototype.getVal=function(a){return this.get(a).get()},b.prototype.exists=function(a){return a in this.properties},{createSynthogramModel:c}}function OscSynth(a,b,c,d,e,f,g,h,i,j,k){function l(a,b){a.value=b.get(),b.addChangeListener(function(c){a.value=c,console.log("set Parameter value",b.name,a.value)})}function m(a,b,c,d){this.input=a.createGain();var e=a.createGain(),f=a.createDelay(),g=a.createGain(),h=a.createGain();l(f.delayTime,b),l(g.gain,c),l(h.gain,d),this.input.connect(f),this.input.connect(e),f.connect(g),f.connect(h),g.connect(f),h.connect(e),this.connect=function(a){e.connect(a)}}function n(){for(var a=0;a<s.length;a++){var b=s[a].oscillator;b.typeByName?b.typeByName(j.get()):b.type=j.get()}}function o(a,b){var c=b,d=Math.pow(2,1/12),e=c*Math.pow(d,a);return e}function p(a,b,c,d){for(var e=[],f=b;b+d>f;f++){var g=a+f,h=Note.fromLatin(g);if("quarter notes"===c)for(var i=0;12>i;i++)e.push({value:o(i,h.frequency()),name:h.latin()+f+"_"+(i+1)});else for(var j=h.scale(c),k=0;k<j.length-1;k++)e.push({value:j[k].frequency(),name:j[k].latin()+f})}return e}function q(a){var b=s[a];return{frequency:b.frequency,name:b.name}}var r=function(){if(window.AudioContext)return new window.AudioContext;throw new Error("Web Audio not supported (could not create audio context")},s=[],t=r(),u=!1,v=t.createGain();v.gain.value=0,v.connect(t.destination);var w=t.createDynamicsCompressor();w.connect(v);var x=new m(t,g,h,i);x.connect(w);var y=x.input,z=function(){f.addChangeListener(function(a){k.get()&&(v.gain.value=a)}),b.addChangeListener(B),c.addChangeListener(B),d.addChangeListener(B),e.addChangeListener(B),j.addChangeListener(n),k.addChangeListener(D),C()},A=function(){if(!u){console.log("initializing from user interaction");var a=t.createOscillator(),b=t.createGain();b.gain.value=0,a.connect(b),b.connect(t.destination),a.start(0),u=!0,window.setTimeout(function(){b.disconnect(),a.disconnect()},100)}},B=function(){console.log("rebuildOscillators");for(var a=s.length;a>0;)a--,s[a].gainNode.disconnect(),s[a].oscillator.disconnect();s=[],C()},C=function(){console.log("createOscillators");for(var f=p(b.get(),c.get(),d.get(),e.get()),g=f.length;g>0;)g--,s.push(E(f[g]));a.set(f.length)},D=function(a){a?(A(),v.gain.value=f.get()):v.gain.value=0},E=function(a){var b=t.createOscillator(),c=t.createGain();return b.type=j.get(),b.frequency.value=a.value,c.gain.value=0,b.connect(c),c.connect(y),b.start(0),{oscillator:b,gain:c.gain,gainNode:c,frequency:a.value,name:a.name}},F=.001,G=function(a){for(var b=0;b<s.length;b++){var c=.1*a[b];Math.abs(s[b].gain.value-c)>F&&(s[b].gain.value=c)}};return z(),{play:G,setOscillatorsType:n,compressor:w,getOscillatorData:q}}function CanvasSource(a,b,c){var d=a.getContext("2d"),e=b.getContext("2d"),f=a.width,g=0,h=function(){return a.height/c.get()},i=function(a){e.clearRect(g-1,0,g+1,b.height),e.beginPath(),e.moveTo(a,0),e.lineTo(a,b.height),e.stroke(),g=a};return{getStep:function(b){for(var e=d.getImageData(b,0,1,a.height),f=e.data,g=h(),j=[],k=0,l=c.get();l>k;k++){for(var m=Math.floor(k*g),n=Math.floor((k+1)*g),o=n-m,p=0;n>m;){var q=f[4*m+0],r=f[4*m+1],s=f[4*m+2],t=f[4*m+3],u=0;0!==t&&(u=(255-(q+r+s)/3)*(t/255)),p+=u,m++}var v=p/o/255;j.push(v)}return i(b),j},numSteps:f,getOscillatorForY:function(a){var b=parseInt(a/h(),10);return b}}}function Sequencer(a,b,c,d){var e=b.numSteps,f=!1,g=!1,h=function(){var a=d.get();f&&(a=(a+1)%e),i(a)},i=function(c){c=parseInt(c,10);var e=b.getStep(d.get());a.play(e),d.set(c)},j=function(){function a(){h(),window.setTimeout(a,1e3/c.get())}console.log("seq.play"),g||(g=!0,a())},k=function(a){f=a,console.log("pauseToggle",f)};return d.addChangeListener(i),{start:j,setIsPlaying:k,isPlaying:function(){return f}}}function sgEventReporter(a){var b={},c=function(a,b,c){return[a,b,c].join("|")};return{send:function(d,e,f,g){console.log("send","event",d,e,f,g),a&&a("send","event",d,e,f,g),b[c(d,e,f)]=!0},sendOnce:function(a,d,e,f){b[c(a,d,e)]||this.send(a,d,e,f)}}}function sgView(a,b){function c(c,e){$(".compSide").sgTab(b),$(".button").sgButton(a,b),$(".horizontal-slider").sgSlider(a,b),$(".buttonset").sgButtonSet(a,b),$(".knob").sgKnob(a,b),$(".harmony.tab-label").click();var f=function(a){var b=a+" / "+$("#wPaint").width();$(".current-position").text(b)};a.get("currentStep").addChangeListener(f),f(0);var g=$("#freqHertz"),h=$("#freqName");d.bind("mousemove",function(a){var b=a.pageY-d.offset().top;if(!(b>=d.height()||0>b)){var e=c(b);g.text(e.frequency.toFixed(2)),h.text(e.name)}}).bind("mouseout",function(){g.text("--"),h.text("--")}),$(".transparentOverlay").on("touchstart touchmove touchend touchcancel",function(){return!1});var i=function(b,c){var d,e,f,g=function(c){var d={};return c?(d.size=Math.floor(20*((c.pageX-b.offset().left)/b.width())),d.size=Math.max(d.size,1),d.x=a.getVal("currentStep")+Math.ceil(d.size/2),d.y=c.pageY-b.offset().top):d={x:a.getVal("currentStep")+Math.ceil(f.size/2),y:f.y,size:f.size},d.size<2&&(d.x=d.x+.5),d},h=function(a){if(d){var b=g(a);f.x>b.x?(i("paintAtCoordinatesUp"),i("paintAtCoordinatesDown",b)):i("paintAtCoordinatesMove",b),a&&j(a)}},i=function(a,b){$("#wPaint").wPaint(a,b),b&&(f=b)};$("body").on("mousedown",function(){d=!0}),$("body").on("mouseup",function(){d=!1,window.clearInterval(e)}),b.on("mousedown",function(b){a.get("isPlaying").set(!0),a.get("isSynthPlaying").set(!0);var d=g(b);i("paintAtCoordinatesDown",d),j(b),window.clearInterval(e),e=window.setInterval(h,20),c.send("mousedown","livePad","livePad")}),b.on("mouseup",function(){i("paintAtCoordinatesUp"),window.clearInterval(e),$(".livePadCursor").hide()}),b.on("mousemove",function(a){h(a)}),b.bindMobileEventsPreventMouse();var j=function(a){var c=60,d=a.pageY-b.offset().top-c/2,e=a.pageX-b.offset().left-c/2;$(".livePadCursor").css({top:d,left:e}),$(".livePadCursor").show()}};i($("#livePad"),b);var j=function(){var b=function(a){var b=c(a);return b.name},d=8,e=Number($("#overlayGrid").attr("height"))/a.getVal("numOscillators");console.log("drawing grid",d,e),$("#overlayGrid").sgGrid(d,e),$("#gridLabelsCanvas").sgGridLabels(e,b),$("#wPaint").wPaint("snapGridVertical",e),$("#wPaint").wPaint("snapGridHorizontal",d)};a.get("numOscillators").addChangeListener(j),a.get("startNote").addChangeListener(j),a.get("startOctave").addChangeListener(j),a.get("musicalScale").addChangeListener(j),j(),$("#share").on("click",function(){e(!0),b.send("click","button","share")}),$("#saveNew").on("click",function(){e(!0),b.send("click","button","saveCopy")}),$("#save").on("click",function(){e(!1),b.send("click","button","save")}),$("#new").on("click",function(){$("#wPaint").wPaint("clear"),window.location.hash="",b.send("click","button","new")}),$("body").on("keydown",function(a){32===a.keyCode?$(".play, .stop").trigger("click"):a.ctrlKey&&90===a.keyCode&&(a.shiftKey?$("#wPaint").wPaint("redo"):$("#wPaint").wPaint("undo"))}),Socialite.load()}$("#wPaint").wPaint({path:"lib/wpaint/",menuOffsetLeft:-115,menuOffsetTop:-46,lineWidth:"4",fillStyle:"#0000FF",strokeStyle:"#000000",menuHandle:!1,onShapeDown:function(){var a=$("#wPaint").wPaint("mode");b.send("wPaint","paint",a)}});var d=$(".wPaint-canvas"),e=function(a){$("#wPaint").wPaint("image",a),window.setTimeout(function(){console.log("addUndo"),$("#wPaint").wPaint("_addUndo")},10)},f=function(){$("#notSupportedModal").dialog({height:200,width:350,modal:!0})};return{paintCanvas:d[0],overlayCanvas:window.document.getElementById("overlay"),init:c,showNotSupported:f,setImage:e,showShareDialog:function(){$("#shareUrl").text(window.location),$("#shareDialog").dialog({minWidth:500})}}}function sgMainController(a,b,c,d,e,f){var g=["stepsPerSecond","startFrequency","delayTime","delayFeedbackGain","delayWetGain","startNoteKey","startOctave","musicalScale","numOctaves","waveShape"],h=Firebase?new Firebase("https://sonogram.firebaseio.com/images"):null,i=function(a){if("undefined"==typeof d)return{name:"--",frequency:0};var b=e.getOscillatorForY(a),c=d.getOscillatorData(b);return c},j=function(c){var d=null;c||(d=l());var e=function(){var a=function(){return Math.floor(16777216*(1+Math.random())).toString(16).substring(1)};return a()+a()};d=d||e();var f=$("#wPaint").wPaint("image"),i={img:f,settings:{},saveDate:(new Date).toISOString()};$.each(g,function(b,c){i.settings[c]=a.getVal(c)}),h.child(d).set(i,function(){console.log("saved",i),window.location.hash=k+d,b.showShareDialog()})},k="#load/",l=function(){var a=window.location.hash,b=null;return 0===a.indexOf(k)&&(b=a.substring(k.length)),console.log("getHashParameters",b),b},m=function(){var c=l();console.log("loadInitialImage",c),c?(console.log("getting for value",c),h.child(c).once("value",function(c){var d=c.val();console.log("loaded",d),b.setImage(d.img),$.each(d.settings,function(b,c){a.exists(b)&&a.get(b).set(c)})})):b.setImage(sgResources.defaultImage)},n=function(){return"undefined"==typeof AudioContext?("undefined"!=typeof Muscula&&Muscula.errors.push(new Error("Browser not supported for Synthogram")),b.showNotSupported(),f.send("not_supported","audioContext","audio context not supported",0),void 0):(f.send("supported","audioContext","audio context supported",1),a.get("isPlaying").addChangeListener(function(a){c.setIsPlaying(a)}),c.start(),b.init(i,j),m(),void 0)};return{init:n}}function synthogramInit(){var a=sgEventReporter(ga),b=sgModel().createSynthogramModel();console.log(b);var c=sgView(b,a),d=new CanvasSource(c.paintCanvas,c.overlayCanvas,b.get("numOscillators")),e=new OscSynth(b.get("numOscillators"),b.get("startNote"),b.get("startOctave"),b.get("musicalScale"),b.get("numOctaves"),b.get("volume"),b.get("delayTime"),b.get("delayFeedbackGain"),b.get("delayWetGain"),b.get("waveShape"),b.get("isSynthPlaying")),f=new Sequencer(e,d,b.get("stepsPerSecond"),b.get("currentStep")),g=sgMainController(b,c,f,e,d,a);g.init()}var MUSIC={notes:{Fb:[6,-10],Cb:[5,-9],Gb:[5,-8],Db:[4,-7],Ab:[4,-6],Eb:[3,-5],Bb:[3,-4],F:[2,-3],C:[1,-2],G:[1,-1],D:[0,0],A:[0,1],E:[-1,2],B:[-1,3],"F#":[-2,4],"C#":[-3,5],"G#":[-3,6],"D#":[-4,7],"A#":[-4,8],"E#":[-5,9],"B#":[-5,10]},baseFreq:440,baseOffset:[4,1],intervals:{unison:[0,0],"minor second":[3,-5],"major second":[-1,2],"minor third":[2,-3],"major third":[-2,4],fourth:[1,-1],"augmented fourth":[-3,6],tritone:[-3,6],"diminished fifth":[4,-6],fifth:[0,1],"minor sixth":[3,-4],"major sixth":[-1,3],"minor seventh":[2,-2],"major seventh":[-2,5],octave:[1,0]},intervals_semitones:{0:[0,0],1:[3,-5],2:[-1,2],3:[2,-3],4:[-2,4],5:[1,-1],6:[-3,6],7:[0,1],8:[3,-4],9:[-1,3],10:[2,-2],11:[-2,5],12:[1,0]},scales:{major:["major second","major third","fourth","fifth","major sixth","major seventh"],"natural minor":["major second","minor third","fourth","fifth","minor sixth","minor seventh"],"harmonic minor":["major second","minor third","fourth","fifth","minor sixth","major seventh"],"major pentatonic":["major second","major third","fifth","major sixth"],"minor pentatonic":["minor third","fourth","minor sixth","minor seventh"]}};Note.prototype.frequency=function(){return MUSIC.baseFreq*Math.pow(2,(1200*this.coord[0]+700*this.coord[1])/1200)},Note.prototype.accidental=function(){return Math.round((this.coord[1]+MUSIC.baseOffset[1])/7)},Note.prototype.octave=function(){var a=this.accidental();return this.coord[0]+MUSIC.baseOffset[0]+4*a+Math.floor((this.coord[1]+MUSIC.baseOffset[1]-7*a)/2)},Note.prototype.latin=function(){var a=["F","C","G","D","A","E","B"],b=["bb","b","","#","x"],c=this.accidental();return a[this.coord[1]+MUSIC.baseOffset[1]-7*c+3]+b[c+2]},Note.fromLatin=function(a){var b,c,d=[],e=0,f=a.split(/(\d+)/);if(f.length>3){for(b=0;b<(f.length-1)/2;b++)c=MUSIC.notes[f[e]],c=[c[0]+parseInt(f[e+1]),c[1]],c[0]-=MUSIC.baseOffset[0],c[1]-=MUSIC.baseOffset[1],d[b]=new Note(c),e+=2;return d}return c=MUSIC.notes[f[0]],c=[c[0]+parseInt(f[1]),c[1]],c[0]-=MUSIC.baseOffset[0],c[1]-=MUSIC.baseOffset[1],new Note(c)},Note.prototype.scale=function(a){var b,c=[],d=MUSIC.scales[a];for(c.push(this.add("unison")),b=0;b<d.length;b++)c[b+1]=this.add(Interval.fromName(d[b]));return c.push(this.add("octave")),c},Note.prototype.add=function(a){var b,c=[];if("string"==typeof a&&(a=Interval.fromName(a)),a.length){for(b=0;b<a.length;b++)c[b]=this.add(a[b]);return add_addsubtract_func(c),c}return new Note([this.coord[0]+a.coord[0],this.coord[1]+a.coord[1]])},Note.prototype.subtract=function(a){var b,c,d=[];if("string"==typeof a&&(a=Interval.fromName(a)),a.length){for(b=0;b<a.length;b++)d[b]=this.subtract(a[b]);return add_addsubtract_func(d),d}return c=[this.coord[0]-a.coord[0],this.coord[1]-a.coord[1]],"function"==typeof a.frequency?new Interval(c):new Note(c)},Interval.fromName=function(a){return new Interval(MUSIC.intervals[a])},Interval.fromSemitones=function(a){return new Interval(MUSIC.intervals_semitones[a])},Interval.fromTonesSemitones=function(a){return new Interval([-1*a[0]+3*a[1],2*a[0]+-5*a[1]])},Interval.prototype.tone_semitone=function(){return[5*this.coord[0]+3*this.coord[1],2*this.coord[0]+1*this.coord[1]]},Interval.prototype.semitone=function(){var a=this.tone_semitone();return 2*a[0]+a[1]},Interval.prototype.add=function(a){return"string"==typeof a&&(a=Interval.fromName(a)),new Interval([this.coord[0]+a.coord[0],this.coord[1]+a.coord[1]])},Interval.prototype.subtract=function(a){return"string"==typeof a&&(a=Interval.fromName(a)),new Note([this.coord[0]-a.coord[0],this.coord[1]-a.coord[1]])},"undefined"==typeof AudioContext&&"undefined"!=typeof webkitAudioContext&&"undefined"!=typeof webkitAudioContext.prototype.createOscillator&&("undefined"==typeof webkitAudioContext.prototype.createGain&&(webkitAudioContext.prototype.createScriptProcessor=webkitAudioContext.prototype.createJavaScriptNode,webkitAudioContext.prototype.createGain=function(){var a=webkitAudioContext.prototype.createGainNode.call(this);return a},webkitAudioContext.prototype.createDelay=function(){var a=webkitAudioContext.prototype.createDelayNode.call(this);return a},webkitAudioContext.prototype._createOscillator=webkitAudioContext.prototype.createOscillator,webkitAudioContext.prototype.createOscillator=function(){var a=webkitAudioContext.prototype._createOscillator.call(this);return a.start=a.noteOn,a.stop=a.noteOff,a.typeByName=function(b){var c={sine:0,square:1,sawtooth:2,triangle:3},d=c[b];a.type=d},a},webkitAudioContext.prototype._createBufferSource=webkitAudioContext.prototype.createBufferSource,webkitAudioContext.prototype.createBufferSource=function(){var a=webkitAudioContext.prototype._createBufferSource.call(this);return a.start=function(b,c,d){void 0===c?a.noteOn(b):a.noteGrainOn(b,c,d)},a.stop=a.noteOff,a},webkitAudioContext.prototype._createBiquadFilter=webkitAudioContext.prototype.createBiquadFilter,webkitAudioContext.prototype.createBiquadFilter=function(){var a=webkitAudioContext.prototype._createBiquadFilter.call(this);return a},webkitAudioContext.prototype._createDynamicsCompressor=webkitAudioContext.prototype.createDynamicsCompressor,webkitAudioContext.prototype.createDynamicsCompressor=function(){var a=webkitAudioContext.prototype._createDynamicsCompressor.call(this);return a}),window.AudioContext=webkitAudioContext),function(a){"use strict";var b={},c=Math.max,d=Math.min;b.c={},b.c.d=a(document),b.c.t=function(a){return a.originalEvent.touches.length-1},b.o=function(){var c=this;this.o=null,this.$=null,this.i=null,this.g=null,this.v=null,this.cv=null,this.x=0,this.y=0,this.w=0,this.h=0,this.$c=null,this.c=null,this.t=0,this.isInit=!1,this.fgColor=null,this.pColor=null,this.dH=null,this.cH=null,this.eH=null,this.rH=null,this.scale=1,this.relative=!1,this.relativeWidth=!1,this.relativeHeight=!1,this.$div=null,this.run=function(){var b=function(a,b){var d;for(d in b)c.o[d]=b[d];c.init(),c._configure()._draw()};if(!this.$.data("kontroled"))return this.$.data("kontroled",!0),this.extend(),this.o=a.extend({min:this.$.data("min")||0,max:this.$.data("max")||100,stopper:!0,readOnly:this.$.data("readonly")||"readonly"==this.$.attr("readonly"),cursor:this.$.data("cursor")===!0&&30||this.$.data("cursor")||0,thickness:this.$.data("thickness")||.35,lineCap:this.$.data("linecap")||"butt",width:this.$.data("width")||200,height:this.$.data("height")||200,displayInput:null==this.$.data("displayinput")||this.$.data("displayinput"),displayPrevious:this.$.data("displayprevious"),fgColor:this.$.data("fgcolor")||"#87CEEB",inputColor:this.$.data("inputcolor")||this.$.data("fgcolor")||"#87CEEB",font:this.$.data("font")||"Arial",fontWeight:this.$.data("font-weight")||"bold",inline:!1,step:this.$.data("step")||1,draw:null,change:null,cancel:null,release:null,error:null},this.o),this.$.is("fieldset")?(this.v={},this.i=this.$.find("input"),this.i.each(function(b){var d=a(this);c.i[b]=d,c.v[b]=d.val(),d.bind("change",function(){var a={};a[b]=d.val(),c.val(a)})}),this.$.find("legend").remove()):(this.i=this.$,this.v=this.$.val(),""==this.v&&(this.v=this.o.min),this.$.bind("change",function(){c.val(c._validate(c.$.val()))})),!this.o.displayInput&&this.$.hide(),this.$c=a(document.createElement("canvas")),"undefined"!=typeof G_vmlCanvasManager&&G_vmlCanvasManager.initElement(this.$c[0]),this.c=this.$c[0].getContext?this.$c[0].getContext("2d"):null,this.c?(this.scale=(window.devicePixelRatio||1)/(this.c.webkitBackingStorePixelRatio||this.c.mozBackingStorePixelRatio||this.c.msBackingStorePixelRatio||this.c.oBackingStorePixelRatio||this.c.backingStorePixelRatio||1),this.relativeWidth=0!==this.o.width%1&&this.o.width.indexOf("%"),this.relativeHeight=0!==this.o.height%1&&this.o.height.indexOf("%"),this.relative=this.relativeWidth||this.relativeHeight,this.$div=a('<div style="'+(this.o.inline?"display:inline;":"")+'"></div>'),this.$.wrap(this.$div).before(this.$c),this.$div=this.$.parent(),this._carve(),this.v instanceof Object?(this.cv={},this.copy(this.v,this.cv)):this.cv=this.v,this.$.bind("configure",b).parent().bind("configure",b),this._listen()._configure()._xy().init(),this.isInit=!0,this._draw(),this):(this.o.error&&this.o.error(),void 0)},this._carve=function(){if(this.relative){var a=this.relativeWidth?this.$div.parent().width()*parseInt(this.o.width)/100:this.$div.parent().width(),b=this.relativeHeight?this.$div.parent().height()*parseInt(this.o.height)/100:this.$div.parent().height();this.w=this.h=Math.min(a,b)}else this.w=this.o.width,this.h=this.o.height;return this.$div.css({width:this.w+"px",height:this.h+"px"}),this.$c.attr({width:this.w,height:this.h}),1!==this.scale&&(this.$c[0].width=this.$c[0].width*this.scale,this.$c[0].height=this.$c[0].height*this.scale,this.$c.width(this.w),this.$c.height(this.h)),this},this._draw=function(){var a=!0;c.g=c.c,c.clear(),c.dH&&(a=c.dH()),a!==!1&&c.draw()},this._touch=function(a){var d=function(a){var b=c.xy2val(a.originalEvent.touches[c.t].pageX,a.originalEvent.touches[c.t].pageY);b!=c.cv&&(c.cH&&c.cH(b)===!1||(c.change(c._validate(b)),c._draw()))};return this.t=b.c.t(a),d(a),b.c.d.bind("touchmove.k",d).bind("touchend.k",function(){b.c.d.unbind("touchmove.k touchend.k"),c.rH&&c.rH(c.cv)===!1||c.val(c.cv)}),this},this._mouse=function(a){var d=function(a){var b=c.xy2val(a.pageX,a.pageY);b!=c.cv&&(c.cH&&c.cH(b)===!1||(c.change(c._validate(b)),c._draw()))};return d(a),b.c.d.bind("mousemove.k",d).bind("keyup.k",function(a){if(27===a.keyCode){if(b.c.d.unbind("mouseup.k mousemove.k keyup.k"),c.eH&&c.eH()===!1)return;c.cancel()}}).bind("mouseup.k",function(){b.c.d.unbind("mousemove.k mouseup.k keyup.k"),c.rH&&c.rH(c.cv)===!1||c.val(c.cv)}),this},this._xy=function(){var a=this.$c.offset();return this.x=a.left,this.y=a.top,this},this._listen=function(){return this.o.readOnly?this.$.attr("readonly","readonly"):(this.$c.bind("mousedown",function(a){a.preventDefault(),c._xy()._mouse(a)}).bind("touchstart",function(a){a.preventDefault(),c._xy()._touch(a)}),this.relative&&a(window).resize(function(){c._carve().init(),c._draw()}),this.listen()),this},this._configure=function(){return this.o.draw&&(this.dH=this.o.draw),this.o.change&&(this.cH=this.o.change),this.o.cancel&&(this.eH=this.o.cancel),this.o.release&&(this.rH=this.o.release),this.o.displayPrevious?(this.pColor=this.h2rgba(this.o.fgColor,"0.4"),this.fgColor=this.h2rgba(this.o.fgColor,"0.6")):this.fgColor=this.o.fgColor,this},this._clear=function(){this.$c[0].width=this.$c[0].width},this._validate=function(a){return~~((0>a?-.5:.5)+a/this.o.step)*this.o.step},this.listen=function(){},this.extend=function(){},this.init=function(){},this.change=function(){},this.val=function(){},this.xy2val=function(){},this.draw=function(){},this.clear=function(){this._clear()},this.h2rgba=function(a,b){var c;return a=a.substring(1,7),c=[parseInt(a.substring(0,2),16),parseInt(a.substring(2,4),16),parseInt(a.substring(4,6),16)],"rgba("+c[0]+","+c[1]+","+c[2]+","+b+")"},this.copy=function(a,b){for(var c in a)b[c]=a[c]}},b.Dial=function(){b.o.call(this),this.startAngle=null,this.xy=null,this.radius=null,this.lineWidth=null,this.cursorExt=null,this.w2=null,this.PI2=2*Math.PI,this.extend=function(){this.o=a.extend({bgColor:this.$.data("bgcolor")||"#EEEEEE",angleOffset:this.$.data("angleoffset")||0,angleArc:this.$.data("anglearc")||360,inline:!0},this.o)},this.val=function(a){return null==a?this.v:(this.cv=this.o.stopper?c(d(a,this.o.max),this.o.min):a,this.v=this.cv,this.$.val(this.v),this._draw(),void 0)},this.xy2val=function(a,b){var e,f;return e=Math.atan2(a-(this.x+this.w2),-(b-this.y-this.w2))-this.angleOffset,this.angleArc!=this.PI2&&0>e&&e>-.5?e=0:0>e&&(e+=this.PI2),f=~~(.5+e*(this.o.max-this.o.min)/this.angleArc)+this.o.min,this.o.stopper&&(f=c(d(f,this.o.max),this.o.min)),f},this.listen=function(){var b,e,f=this,g=function(a){a.preventDefault();var b=a.originalEvent,c=b.detail||b.wheelDeltaX,d=b.detail||b.wheelDeltaY,e=parseInt(f.$.val())+(c>0||d>0?f.o.step:0>c||0>d?-f.o.step:0);f.cH&&f.cH(e)===!1||f.val(e)},h=1,i={37:-f.o.step,38:f.o.step,39:f.o.step,40:-f.o.step};this.$.bind("keydown",function(g){var j=g.keyCode;if(j>=96&&105>=j&&(j=g.keyCode=j-48),b=parseInt(String.fromCharCode(j)),isNaN(b)&&(13!==j&&8!==j&&9!==j&&189!==j&&g.preventDefault(),a.inArray(j,[37,38,39,40])>-1)){g.preventDefault();var k=parseInt(f.$.val())+i[j]*h;f.o.stopper&&(k=c(d(k,f.o.max),f.o.min)),f.change(k),f._draw(),e=window.setTimeout(function(){h*=2},30)}}).bind("keyup",function(){isNaN(b)?e&&(window.clearTimeout(e),e=null,h=1,f.val(f.$.val())):f.$.val()>f.o.max&&f.$.val(f.o.max)||f.$.val()<f.o.min&&f.$.val(f.o.min)}),this.$c.bind("mousewheel DOMMouseScroll",g),this.$.bind("mousewheel DOMMouseScroll",g)},this.init=function(){(this.v<this.o.min||this.v>this.o.max)&&(this.v=this.o.min),this.$.val(this.v),this.w2=this.w/2,this.cursorExt=this.o.cursor/100,this.xy=this.w2*this.scale,this.lineWidth=this.xy*this.o.thickness,this.lineCap=this.o.lineCap,this.radius=this.xy-this.lineWidth/2,this.o.angleOffset&&(this.o.angleOffset=isNaN(this.o.angleOffset)?0:this.o.angleOffset),this.o.angleArc&&(this.o.angleArc=isNaN(this.o.angleArc)?this.PI2:this.o.angleArc),this.angleOffset=this.o.angleOffset*Math.PI/180,this.angleArc=this.o.angleArc*Math.PI/180,this.startAngle=1.5*Math.PI+this.angleOffset,this.endAngle=1.5*Math.PI+this.angleOffset+this.angleArc;var a=c(String(Math.abs(this.o.max)).length,String(Math.abs(this.o.min)).length,2)+2;this.o.displayInput&&this.i.css({width:(this.w/2+4>>0)+"px",height:(this.w/3>>0)+"px",position:"absolute","vertical-align":"middle","margin-top":(this.w/3>>0)+"px","margin-left":"-"+(3*this.w/4+2>>0)+"px",border:0,background:"none",font:this.o.fontWeight+" "+(this.w/a>>0)+"px "+this.o.font,"text-align":"center",color:this.o.inputColor||this.o.fgColor,padding:"0px","-webkit-appearance":"none"})||this.i.css({width:"0px",visibility:"hidden"})},this.change=function(a){this.cv=a,this.$.val(a)},this.angle=function(a){return(a-this.o.min)*this.angleArc/(this.o.max-this.o.min)},this.draw=function(){var a,b,c=this.g,d=this.angle(this.cv),e=this.startAngle,f=e+d,g=1;c.lineWidth=this.lineWidth,c.lineCap=this.lineCap,this.o.cursor&&(e=f-this.cursorExt)&&(f+=this.cursorExt),c.beginPath(),c.strokeStyle=this.o.bgColor,c.arc(this.xy,this.xy,this.radius,this.endAngle,this.startAngle,!0),c.stroke(),this.o.displayPrevious&&(b=this.startAngle+this.angle(this.v),a=this.startAngle,this.o.cursor&&(a=b-this.cursorExt)&&(b+=this.cursorExt),c.beginPath(),c.strokeStyle=this.pColor,c.arc(this.xy,this.xy,this.radius,a,b,!1),c.stroke(),g=this.cv==this.v),c.beginPath(),c.strokeStyle=g?this.o.fgColor:this.fgColor,c.arc(this.xy,this.xy,this.radius,e,f,!1),c.stroke()},this.cancel=function(){this.val(this.v)}},a.fn.dial=a.fn.knob=function(c){return this.each(function(){var d=new b.Dial;d.o=c,d.$=a(this),d.run()}).parent()}}(jQuery),window.Socialite=function(a,b,c){"use strict";var d=0,e=[],f={},g={},h=/^($|loaded|complete)/,i=a.encodeURIComponent,j={settings:{},trim:function(a){return a.trim?a.trim():a.replace(/^\s+|\s+$/g,"")},hasClass:function(a,b){return-1!==(" "+a.className+" ").indexOf(" "+b+" ")},addClass:function(a,b){j.hasClass(a,b)||(a.className=""===a.className?b:a.className+" "+b)},removeClass:function(a,b){a.className=j.trim(" "+a.className+" ".replace(" "+b+" "," "))},extendObject:function(a,b,d){for(var e in b){var f=a[e]!==c;f&&"object"==typeof b[e]?j.extendObject(a[e],b[e],d):(d||!f)&&(a[e]=b[e])}},getElements:function(a,b){for(var c=0,d=[],e=!!a.getElementsByClassName,f=e?a.getElementsByClassName(b):a.getElementsByTagName("*");f.length>c;c++)(e||j.hasClass(f[c],b))&&d.push(f[c]);return d},getDataAttributes:function(a,b,c){for(var d=0,e="",f={},g=a.attributes;g.length>d;d++){var h=g[d].name,j=g[d].value;j.length&&0===h.indexOf("data-")&&(b&&(h=h.substring(5)),c?f[h]=j:e+=i(h)+"="+i(j)+"&")}return c?f:e},copyDataAttributes:function(a,b,c,d){var e=j.getDataAttributes(a,c,!0);for(var f in e)b.setAttribute(d?f.replace(/-/g,"_"):f,e[f])},createIframe:function(a,c){var d=b.createElement("iframe");return d.style.cssText="overflow: hidden; border: none;",j.extendObject(d,{src:a,allowtransparency:"true",frameborder:"0",scrolling:"no"},!0),c&&(d.onload=d.onreadystatechange=function(){h.test(d.readyState||"")&&(d.onload=d.onreadystatechange=null,j.activateInstance(c))}),d},networkReady:function(a){return f[a]?f[a].loaded:c},appendNetwork:function(a){if(a&&!a.appended){if("function"==typeof a.append&&a.append(a)===!1)return a.appended=a.loaded=!0,j.activateAll(a),c;a.script&&(a.el=b.createElement("script"),j.extendObject(a.el,a.script,!0),a.el.async=!0,a.el.onload=a.el.onreadystatechange=function(){if(h.test(a.el.readyState||"")){if(a.el.onload=a.el.onreadystatechange=null,a.loaded=!0,"function"==typeof a.onload&&a.onload(a)===!1)return;j.activateAll(a)}},b.body.appendChild(a.el)),a.appended=!0}},removeNetwork:function(a){return j.networkReady(a.name)?(a.el.parentNode&&a.el.parentNode.removeChild(a.el),!(a.appended=a.loaded=!1)):!1},reloadNetwork:function(a){var b=f[a];b&&j.removeNetwork(b)&&j.appendNetwork(b)},createInstance:function(a,b){var f=!0,g={el:a,uid:d++,widget:b};return e.push(g),b.process!==c&&(f="function"==typeof b.process?b.process(g):!1),f&&j.processInstance(g),g.el.setAttribute("data-socialite",g.uid),g.el.className="socialite "+b.name+" socialite-instance",g},processInstance:function(a){var c=a.el;a.el=b.createElement("div"),a.el.className=c.className,j.copyDataAttributes(c,a.el),"a"!==c.nodeName.toLowerCase()||c.getAttribute("data-default-href")||a.el.setAttribute("data-default-href",c.getAttribute("href"));var d=c.parentNode;d.insertBefore(a.el,c),d.removeChild(c)},activateInstance:function(a){return a&&!a.loaded?(a.loaded=!0,"function"==typeof a.widget.activate&&a.widget.activate(a),j.addClass(a.el,"socialite-loaded"),a.onload?a.onload(a.el):null):c},activateAll:function(a){"string"==typeof a&&(a=f[a]);for(var b=0;e.length>b;b++){var c=e[b];c.init&&c.widget.network===a&&j.activateInstance(c)}},load:function(a,d,f,h,i){if(a=a&&"object"==typeof a&&1===a.nodeType?a:b,!d||"object"!=typeof d)return j.load(a,j.getElements(a,"socialite"),f,h,i),c;var k;if(/Array/.test(Object.prototype.toString.call(d)))for(k=0;d.length>k;k++)j.load(a,d[k],f,h,i);else if(1===d.nodeType){if(!f||!g[f]){f=null;var l=d.className.split(" ");for(k=0;l.length>k;k++)if(g[l[k]]){f=l[k];break}if(!f)return}var m,n=g[f],o=parseInt(d.getAttribute("data-socialite"),10);if(isNaN(o))m=j.createInstance(d,n);else for(k=0;e.length>k;k++)if(e[k].uid===o){m=e[k];break}!i&&m&&(m.init||(m.init=!0,m.onload="function"==typeof h?h:null,n.init(m)),n.network.appended?j.networkReady(n.network.name)&&j.activateInstance(m):j.appendNetwork(n.network))}},activate:function(b,c,d){a.Socialite.load(null,b,c,d)},process:function(b,c,d){a.Socialite.load(b,c,d,null,!0)},network:function(a,b){f[a]={name:a,el:null,appended:!1,loaded:!1,widgets:{}},b&&j.extendObject(f[a],b)},widget:function(a,b,c){c.name=a+"-"+b,f[a]&&!g[c.name]&&(c.network=f[a],f[a].widgets[b]=g[c.name]=c)},setup:function(a){j.extendObject(j.settings,a,!0)}};return j}(window,window.document),function(a,b,c){c.setup({facebook:{lang:"en_GB",appId:null},twitter:{lang:"en"},googleplus:{lang:"en-GB"}}),c.network("facebook",{script:{src:"//connect.facebook.net/{{language}}/all.js",id:"facebook-jssdk"},append:function(d){var e=b.createElement("div"),f=c.settings.facebook,g={onlike:"edge.create",onunlike:"edge.remove",onsend:"message.send"};e.id="fb-root",b.body.appendChild(e),d.script.src=d.script.src.replace("{{language}}",f.lang),a.fbAsyncInit=function(){a.FB.init({appId:f.appId,xfbml:!0});for(var b in g)"function"==typeof f[b]&&a.FB.Event.subscribe(g[b],f[b])}}}),c.widget("facebook","like",{init:function(d){var e=b.createElement("div");e.className="fb-like",c.copyDataAttributes(d.el,e),d.el.appendChild(e),a.FB&&a.FB.XFBML&&a.FB.XFBML.parse(d.el)}}),c.network("twitter",{script:{src:"//platform.twitter.com/widgets.js",id:"twitter-wjs",charset:"utf-8"},append:function(){var b="object"!=typeof a.twttr,d=c.settings.twitter,e=["click","tweet","retweet","favorite","follow"];return b&&(a.twttr=t={_e:[],ready:function(a){t._e.push(a)
}}),a.twttr.ready(function(a){for(var b=0;e.length>b;b++){var f=e[b];"function"==typeof d["on"+f]&&a.events.bind(f,d["on"+f])}c.activateAll("twitter")}),b}});var d=function(a){var d=b.createElement("a");d.className=a.widget.name+"-button",c.copyDataAttributes(a.el,d),d.setAttribute("href",a.el.getAttribute("data-default-href")),d.setAttribute("data-lang",a.el.getAttribute("data-lang")||c.settings.twitter.lang),a.el.appendChild(d)},e=function(){a.twttr&&"object"==typeof a.twttr.widgets&&"function"==typeof a.twttr.widgets.load&&a.twttr.widgets.load()};c.widget("twitter","share",{init:d,activate:e}),c.widget("twitter","follow",{init:d,activate:e}),c.widget("twitter","hashtag",{init:d,activate:e}),c.widget("twitter","mention",{init:d,activate:e}),c.widget("twitter","embed",{process:function(a){a.innerEl=a.el,a.innerEl.getAttribute("data-lang")||a.innerEl.setAttribute("data-lang",c.settings.twitter.lang),a.el=b.createElement("div"),a.el.className=a.innerEl.className,a.innerEl.className="",a.innerEl.parentNode.insertBefore(a.el,a.innerEl),a.el.appendChild(a.innerEl)},init:function(a){a.innerEl.className="twitter-tweet"},activate:e}),c.network("googleplus",{script:{src:"//apis.google.com/js/plusone.js"},append:function(){return a.gapi?!1:(a.___gcfg={lang:c.settings.googleplus.lang,parsetags:"explicit"},void 0)}});var f=function(a){var d=b.createElement("div");d.className="g-"+a.widget.gtype,c.copyDataAttributes(a.el,d),a.el.appendChild(d),a.gplusEl=d},g=function(a,b){return"function"!=typeof b?null:function(c){b(a.el,c)}},h=function(b){var d=b.widget.gtype;if(a.gapi&&a.gapi[d]){for(var e=c.settings.googleplus,f=c.getDataAttributes(b.el,!0,!0),h=["onstartinteraction","onendinteraction","callback"],i=0;h.length>i;i++)f[h[i]]=g(b,e[h[i]]);a.gapi[d].render(b.gplusEl,f)}};c.widget("googleplus","one",{init:f,activate:h,gtype:"plusone"}),c.widget("googleplus","share",{init:f,activate:h,gtype:"plus"}),c.widget("googleplus","badge",{init:f,activate:h,gtype:"plus"}),c.network("linkedin",{script:{src:"//platform.linkedin.com/in.js"}});var i=function(d){var e=b.createElement("script");e.type="IN/"+d.widget.intype,c.copyDataAttributes(d.el,e),d.el.appendChild(e),"object"==typeof a.IN&&"function"==typeof a.IN.parse&&(a.IN.parse(d.el),c.activateInstance(d))};c.widget("linkedin","share",{init:i,intype:"Share"}),c.widget("linkedin","recommend",{init:i,intype:"RecommendProduct"})}(window,window.document,window.Socialite),function(){var a=window._socialite;if(/Array/.test(Object.prototype.toString.call(a)))for(var b=0,c=a.length;c>b;b++)"function"==typeof a[b]&&a[b]()}(),!function(a){"use strict";function b(b,c){this.$el=a(b),this.options=c,this.init=!1,this.menus={primary:null,active:null,all:{}},this.previousMode=null,this.width=this.$el.width(),this.height=this.$el.height(),this.ctxBgResize=!1,this.ctxResize=!1,this.generate(),this._init()}function c(a,b,c){this.wPaint=a,this.options=c,this.name=b,this.type=a.menus.primary?"secondary":"primary",this.docked=!0,this.dockOffset={left:0,top:0},this.generate()}b.prototype={generate:function(){function b(b){var c=b?b.capitalize():"",d="canvas"+c,e="ctx"+c;return f[d]=document.createElement("canvas"),f[e]=f[d].getContext("2d"),f["$"+d]=a(f[d]),f["$"+d].attr("class","wPaint-canvas"+(b?"-"+b:"")).attr("width",f.width+"px").attr("height",f.height+"px").css({position:"absolute",left:0,top:0}),f.$el.append(f["$"+d]),f["$"+d]}function c(a){a.preventDefault(),a.stopPropagation(),f.draw=!0,a.canvasEvent="down",f._closeSelectBoxes(),f._callShapeFunc.apply(f,[a])}function d(a){f.draw&&(a.canvasEvent="move",f._callShapeFunc.apply(f,[a]))}function e(a){f.draw&&(f.draw=!1,a.canvasEvent="up",f._callShapeFunc.apply(f,[a]))}if(this.init)return this;var f=this;b("bg"),b("").on("mousedown",c).bindMobileEvents(),b("temp").hide(),a(document).on("mousemove",d).on("mousedown",a.proxy(this._closeSelectBoxes,this)).on("mouseup",e),this.setTheme(this.options.theme)},_init:function(){var a=null,b=null;this.init=!0;for(a in this.options)b="set"+a.capitalize(),this[b]&&this[b](this.options[a]);this._fixMenus(),this.menus.primary._getIcon(this.options.mode).trigger("click")},resize:function(){var a=this.getBg(),b=this.getImage();this.width=this.$el.width(),this.height=this.$el.height(),this.canvasBg.width=this.width,this.canvasBg.height=this.height,this.canvas.width=this.width,this.canvas.height=this.height,this.ctxBgResize===!1&&(this.ctxBgResize=!0,this.setBg(a,!0)),this.ctxResize===!1&&(this.ctxResize=!0,this.setImage(b,"",!0))},setTheme:function(a){var b,c;for(a=a.split(" "),this.$el.attr("class",(this.$el.attr("class")||"").replace(/wPaint-theme-.+\s|wPaint-theme-.+$/,"")),b=0,c=a.length;c>b;b++)this.$el.addClass("wPaint-theme-"+a[b])},setMode:function(a){this.setCursor(a),this.previousMode=this.options.mode,this.options.mode=a},setImage:function(b,c,d){function e(){var a=1,b=0,e=0,i=0,j=0,k=g.width,l=g.height;d||((g.width>f.width||g.height>f.height)&&(b=f.width/g.width,e=f.height/g.height,a=e>b?b:e,k=g.width*a,l=g.height*a),i=(f.width-k)/2,j=(f.height-l)/2),h.clearRect(0,0,f.width,f.height),h.drawImage(g,i,j,k,l),h||f._imageOnload(),f[c+"Resize"]=!1}if(!b)return!0;var f=this,g=null,h="";c="ctx"+(c||"").capitalize(),h=this[c],window.rgbHex(b)?(h.clearRect(0,0,this.width,this.height),h.fillStyle=b,h.rect(0,0,this.width,this.height),h.fill()):(g=new Image,g.src=b.toString(),a(g).load(e))},setBg:function(a,b){return a?(this.setImage(a,"bg",b),void 0):!0},setCursor:function(b){b=a.fn.wPaint.cursors[b]||a.fn.wPaint.cursors["default"],this.$el.css("cursor",'url("'+this.options.path+b.path+'") '+b.left+" "+b.top+", default")},getImage:function(b){var c=document.createElement("canvas"),d=c.getContext("2d");return b=b===!1?!1:!0,a(c).css({display:"none",position:"absolute",left:0,top:0}).attr("width",this.width).attr("height",this.height),b&&d.drawImage(this.canvasBg,0,0),d.drawImage(this.canvas,0,0),c.toDataURL()},getBg:function(){return this.canvasBg.toDataURL()},_displayStatus:function(b){var c=this;this.$status||(this.$status=a('<div class="wPaint-status"></div>'),this.$el.append(this.$status)),this.$status.html(b),clearTimeout(this.displayStatusTimer),this.$status.fadeIn(500,function(){c.displayStatusTimer=setTimeout(function(){c.$status.fadeOut(500)},1500)})},_showModal:function(a){function b(){d.remove(),e.remove(),c._createModal(a)}var c=this,d=this.$el.children(".wPaint-modal-bg"),e=this.$el.children(".wPaint-modal");d.length?e.fadeOut(500,b):this._createModal(a)},_createModal:function(b){function c(){f.fadeOut(500,d)}function d(){e.remove(),f.remove()}b=a('<div class="wPaint-modal-content"></div>').append(b.children());var e=a('<div class="wPaint-modal-bg"></div>'),f=a('<div class="wPaint-modal"></div>'),g=a('<div class="wPaint-modal-holder"></div>'),h=a('<div class="wPaint-modal-close">X</div>');h.on("click",c),f.append(g.append(b)).append(h),this.$el.append(e).append(f),f.css({left:this.$el.outerWidth()/2-f.outerWidth(!0)/2,top:this.$el.outerHeight()/2-f.outerHeight(!0)/2}),f.fadeIn(500)},_createMenu:function(a,b){return b=b||{},b.alignment=this.options.menuOrientation,b.handle=this.options.menuHandle,new c(this,a,b)},_fixMenus:function(){function b(b,d){var e=a(d),f=e.clone();f.appendTo(c.$el),f.outerHeight()===f.get(0).scrollHeight&&e.css({overflowY:"auto"}),f.remove()}var c=this,d=null;for(var e in this.menus.all)d=c.menus.all[e].$menu.find(".wPaint-menu-select-holder"),d.length&&d.children().each(b)},_closeSelectBoxes:function(a){var b,c;for(b in this.menus.all)c=this.menus.all[b].$menuHolder.children(".wPaint-menu-icon-select"),a&&(c=c.not(".wPaint-menu-icon-name-"+a.name)),c.children(".wPaint-menu-select-holder").hide()},_imageOnload:function(){},_callShapeFunc:function(a){var b=this.$canvas.offset(),c=a.canvasEvent.capitalize(),d="_draw"+this.options.mode.capitalize()+c;a.pageX=Math.floor(a.pageX-b.left),a.pageY=Math.floor(a.pageY-b.top),this[d]&&this[d].apply(this,[a]),this.options["draw"+c]&&this.options["_draw"+c].apply(this,[a]),"Down"===c&&this.options.onShapeDown?this.options.onShapeDown.apply(this,[a]):"Move"===c&&this.options.onShapeMove?this.options.onShapeMove.apply(this,[a]):"Up"===c&&this.options.onShapeUp&&this.options.onShapeUp.apply(this,[a])},_stopPropagation:function(a){a.stopPropagation()},_drawShapeDown:function(a){this.$canvasTemp.css({left:a.PageX,top:a.PageY}).attr("width",0).attr("height",0).show(),this.canvasTempLeftOriginal=a.pageX,this.canvasTempTopOriginal=a.pageY},_drawShapeMove:function(b,c){var d=this.canvasTempLeftOriginal,e=this.canvasTempTopOriginal;c=c||2,b.left=b.pageX<d?b.pageX:d,b.top=b.pageY<e?b.pageY:e,b.width=Math.abs(b.pageX-d),b.height=Math.abs(b.pageY-e),b.x=this.options.lineWidth/2*c,b.y=this.options.lineWidth/2*c,b.w=b.width-this.options.lineWidth*c,b.h=b.height-this.options.lineWidth*c,a(this.canvasTemp).css({left:b.left,top:b.top}).attr("width",b.width).attr("height",b.height),this.canvasTempLeftNew=b.left,this.canvasTempTopNew=b.top,c=c||2,this.ctxTemp.fillStyle=this.options.fillStyle,this.ctxTemp.strokeStyle=this.options.strokeStyle,this.ctxTemp.lineWidth=this.options.lineWidth*c},_drawShapeUp:function(){this.ctx.drawImage(this.canvasTemp,this.canvasTempLeftNew,this.canvasTempTopNew),this.$canvasTemp.hide()},_drawDropperDown:function(a){var b={x:a.pageX,y:a.pageY},c=this._getPixel(this.ctx,b),d=null;d="rgba("+[c.r,c.g,c.b,c.a].join(",")+")",this.options[this.dropper]=d,this.menus.active._getIcon(this.dropper).wColorPicker("color",d)},_drawDropperUp:function(){this.setMode(this.previousMode)},_getPixel:function(a,b){var c=a.getImageData(0,0,this.width,this.height),d=c.data,e=4*(b.y*c.width+b.x);return{r:d[e],g:d[e+1],b:d[e+2],a:d[e+3]}}},c.prototype={generate:function(){var b=null;this.$menu=a('<div class="wPaint-menu"></div>'),this.$menuHolder=a('<div class="wPaint-menu-holder wPaint-menu-name-'+this.name+'"></div>'),this.options.handle?this.$menuHandle=this._createHandle():this.$menu.addClass("wPaint-menu-nohandle"),"primary"===this.type?(this.wPaint.menus.primary=this,this.setOffsetLeft(this.options.offsetLeft),this.setOffsetTop(this.options.offsetTop)):"secondary"===this.type&&this.$menu.hide(),this.$menu.append(this.$menuHolder.append(this.$menuHandle)),this.reset(),this.setAlignment(this.options.alignment),this.wPaint.$el.append(this.$menu),b=this.$menu.css("left"),this.$menu.css("left",-1e4),this.$menu.width(this.$menu.width()),this.$menu.css("left",b),"secondary"===this.type&&("horizontal"===this.options.alignment?this.dockOffset.top=this.wPaint.menus.primary.$menu.outerHeight(!0):this.dockOffset.left=this.wPaint.menus.primary.$menu.outerWidth(!0))},reset:function(){function b(a){d._appendItem(a)}var c,d=this,e=a.fn.wPaint.menus[this.name];for(c in e.items)this.$menuHolder.children(".wPaint-menu-icon-name-"+c).length||(e.items[c].name=c,e.items[c].img=d.wPaint.options.path+(e.items[c].img||e.img),b(e.items[c]))},_appendItem:function(a){var b=this["_createIcon"+a.icon.capitalize()](a);a.after?this.$menuHolder.children(".wPaint-menu-icon-name-"+a.after).after(b):this.$menuHolder.append(b)},setOffsetLeft:function(a){this.$menu.css({left:a})},setOffsetTop:function(a){this.$menu.css({top:a})},setAlignment:function(a){this.$menu.attr("class",this.$menu.attr("class").replace(/wPaint-menu-alignment-.+\s|wPaint-menu-alignment-.+$/,"")),this.$menu.addClass("wPaint-menu-alignment-"+a)},_createHandle:function(){function b(){e.docked=!1,e._setDrag()}function c(){a.each(e.$menu.data("ui-draggable").snapElements,function(a,b){var c=e.$menu.offset(),d=e.wPaint.menus.primary.$menu.offset();e.dockOffset.left=c.left-d.left,e.dockOffset.top=c.top-d.top,e.docked=b.snapping}),e._setDrag()}function d(){e._setIndex()}var e=this,f=a('<div class="wPaint-menu-handle"></div>');return this.$menu.draggable({handle:f}),"secondary"===this.type&&(this.$menu.draggable("option","snap",this.wPaint.menus.primary.$menu),this.$menu.draggable("option","start",b),this.$menu.draggable("option","stop",c),this.$menu.draggable("option","drag",d)),f.bindMobileEvents(),f},_createIconBase:function(b){function c(b){var c=a(b.currentTarget);c.siblings(".hover").removeClass("hover"),c.hasClass("disabled")||c.addClass("hover")}function d(b){a(b.currentTarget).removeClass("hover")}function e(){f.wPaint.menus.active=f}var f=this,g=a('<div class="wPaint-menu-icon wPaint-menu-icon-name-'+b.name+'"></div>'),h=a('<div class="wPaint-menu-icon-img"></div>'),i=h.realWidth(null,null,this.wPaint.$el);return g.attr("title",b.title).on("mousedown",a.proxy(this.wPaint._closeSelectBoxes,this.wPaint,b)).on("mouseenter",c).on("mouseleave",d).on("click",e),a.isNumeric(b.index)&&h.css({backgroundImage:"url("+b.img+")",backgroundPosition:-i*b.index+"px 0px"}),g.append(h)},_createIconGroup:function(b){function c(){h.children(".wPaint-menu-select-holder").is(":visible")||b.callback.apply(f.wPaint,[])}function d(){h.addClass("active").siblings(".active").removeClass("active")}function e(){h.attr("title",b.title).off("click.setIcon").on("click.setIcon",c),h.children(".wPaint-menu-icon-img").css(g),b.callback.apply(f.wPaint,[])}var f=this,g={backgroundImage:"url("+b.img+")"},h=this.$menuHolder.children(".wPaint-menu-icon-group-"+b.group),i=h.length,j=null,k=null,l=null,m=0;return i||(h=this._createIconBase(b).addClass("wPaint-menu-icon-group wPaint-menu-icon-group-"+b.group).on("click.setIcon",c).on("mousedown",a.proxy(this._iconClick,this))),m=h.children(".wPaint-menu-icon-img").realWidth(null,null,this.wPaint.$el),g.backgroundPosition=-m*b.index+"px center",j=h.children(".wPaint-menu-select-holder"),j.length||(j=this._createSelectBox(h),j.children().on("click",d)),l=a('<div class="wPaint-menu-icon-select-img"></div>').attr("title",b.title).css(g),k=this._createSelectOption(j,l).addClass("wPaint-menu-icon-name-"+b.name).on("click",e),b.after&&j.children(".wPaint-menu-select").children(".wPaint-menu-icon-name-"+b.after).after(k),i?void 0:h},_createIconGeneric:function(a){return this._createIconActivate(a)},_createIconActivate:function(a){function b(b){"generic"!==a.icon&&c._iconClick(b),a.callback.apply(c.wPaint,[b])}if(a.group)return this._createIconGroup(a);var c=this,d=this._createIconBase(a);return d.on("click",b),d},_isIconDisabled:function(a){return this.$menuHolder.children(".wPaint-menu-icon-name-"+a).hasClass("disabled")},_setIconDisabled:function(a,b){var c=this.$menuHolder.children(".wPaint-menu-icon-name-"+a);b?c.addClass("disabled").removeClass("hover"):c.removeClass("disabled")},_getIcon:function(a){return this.$menuHolder.children(".wPaint-menu-icon-name-"+a)},_iconClick:function(b){var c=a(b.currentTarget),d=this.wPaint.menus.all;for(var e in d)d[e]&&"secondary"===d[e].type&&d[e].$menu.hide();c.siblings(".active").removeClass("active"),c.hasClass("disabled")||c.addClass("active")},_createIconToggle:function(a){function b(){d.toggleClass("active"),a.callback.apply(c.wPaint,[d.hasClass("active")])}var c=this,d=this._createIconBase(a);return d.on("click",b),d},_createIconSelect:function(b){function c(c){h.children(".wPaint-menu-icon-img").html(a(c.currentTarget).html()),b.callback.apply(g.wPaint,[a(c.currentTarget).html()])}var d,e,f,g=this,h=this._createIconBase(b),i=this._createSelectBox(h);for(d=0,e=b.range.length;e>d;d++)f=this._createSelectOption(i,b.range[d]),f.on("click",c),b.useRange&&f.css(b.name,b.range[d]);return h},_createSelectBox:function(b){function c(a){a.stopPropagation(),g.hide()}function d(){i=setTimeout(function(){g.toggle()},200)}function e(){clearTimeout(i)}function f(){g.toggle()}var g=a('<div class="wPaint-menu-select-holder"></div>'),h=a('<div class="wPaint-menu-select"></div>'),i=null;return g.on("mousedown mouseup",this.wPaint._stopPropagation).on("click",c).hide(),"horizontal"===this.options.alignment?g.css({left:0,top:b.children(".wPaint-menu-icon-img").realHeight("outer",!0,this.wPaint.$el)}):g.css({left:b.children(".wPaint-menu-icon-img").realWidth("outer",!0,this.wPaint.$el),top:0}),b.addClass("wPaint-menu-icon-select").append('<div class="wPaint-menu-icon-group-arrow"></div>').append(g.append(h)),b.hasClass("wPaint-menu-icon-group")?b.on("mousedown",d).on("mouseup",e):b.on("click",f),g},_createSelectOption:function(b,c){var d=b.children(".wPaint-menu-select"),e=a('<div class="wPaint-menu-select-option"></div>').append(c);return d.children().length||e.addClass("first"),d.append(e),e},_setSelectValue:function(a,b){this._getIcon(a).children(".wPaint-menu-icon-img").html(b)},_createIconColorPicker:function(a){function b(){"dropper"===e.wPaint.options.mode&&e.wPaint.setMode(e.wPaint.previousMode)}function c(b){a.callback.apply(e.wPaint,[b])}function d(){f.trigger("click"),e.wPaint.dropper=a.name,e.wPaint.setMode("dropper")}var e=this,f=this._createIconBase(a);return f.on("click",b).addClass("wPaint-menu-colorpicker").wColorPicker({mode:"click",generateButton:!1,dropperButton:!0,onSelect:c,onDropper:d}),f},_setColorPickerValue:function(a,b){this._getIcon(a).children(".wPaint-menu-icon-img").css("backgroundColor",b)},_createIconMenu:function(a){function b(){c.wPaint.setCursor(a.name);var b=c.wPaint.menus.all[a.name];b.$menu.toggle(),c.handle?b._setDrag():b._setPosition()}var c=this,d=this._createIconActivate(a);return d.on("click",b),d},_setDrag:function(){var b=this.$menu,c=null,d=null;b.is(":visible")&&(this.docked&&(c=d=a.proxy(this._setPosition,this),this._setPosition()),this.wPaint.menus.primary.$menu.draggable("option","drag",c),this.wPaint.menus.primary.$menu.draggable("option","stop",d))},_setPosition:function(){var a=this.wPaint.menus.primary.$menu.position();this.$menu.css({left:a.left+this.dockOffset.left,top:a.top+this.dockOffset.top})},_setIndex:function(){var a=this.wPaint.menus.primary.$menu.offset(),b=this.$menu.offset();b.top<a.top||b.left<a.left?this.$menu.addClass("wPaint-menu-behind"):this.$menu.removeClass("wPaint-menu-behind")}},a.support.canvas=document.createElement("canvas").getContext,a.fn.wPaint=function(c,d){function e(b,e){var f=a(e).data("wPaint"),g=null;f&&(g=(d?"set":"get")+c.charAt(0).toUpperCase()+c.substring(1).toLowerCase(),f[c]?f[c].apply(f,[d]):d?(f[g]&&f[g].apply(f,[d]),f.options[c]&&(f.options[c]=d)):f[g]?h.push(f[g].apply(f,[d])):f.options[c]?h.push(f.options[c]):h.push(null))}function f(b,c){return a.support.canvas?(g(c),void 0):(a(c).html("Browser does not support HTML5 canvas, please upgrade to a more modern browser."),!1)}function g(d){var e=a.data(d,"wPaint");if(!e){var f=a.extend(!0,{},c);f.lineWidth=parseInt(f.lineWidth,10),f.fontSize=parseInt(f.fontSize,10),e=new b(d,f),a.data(d,"wPaint",e)}return e}if("string"==typeof c){var h=[],i=null;return i=this.each(e),1===h.length?h[0]:h.length>0?h:i}return c=a.extend({},a.fn.wPaint.defaults,c),this.each(f)},a.fn.wPaint.extend=function(a,d){function e(c){if(d[c]){var e=b.prototype[c],f=a[c];d[c]=function(){e.apply(this,arguments),f.apply(this,arguments)}}else d[c]=a[c]}var f;d="menu"===d?c.prototype:b.prototype;for(f in a)e(f)},a.fn.wPaint.menus={},a.fn.wPaint.cursors={},a.fn.wPaint.defaults={path:"/",theme:"standard classic",autoScaleImage:!0,autoCenterImage:!0,menuHandle:!0,menuOrientation:"horizontal",menuOffsetLeft:5,menuOffsetTop:5,bg:null,image:null,onShapeDown:null,onShapeMove:null,onShapeUp:null}}(jQuery),function(){String.prototype.capitalize||(String.prototype.capitalize=function(){return this.slice(0,1).toUpperCase()+this.slice(1)})}(),function(a){a.fn.realWidth=function(b,c,d){var e=null,f=null,g=null;return b="inner"===b||"outer"===b?b:"",g=""===b?"width":b+"Width",c=c===!0?!0:!1,f=a(this).clone().css({position:"absolute",left:-1e4}).appendTo(d||"body"),e=c?f[g](c):f[g](),f.remove(),e},a.fn.realHeight=function(b,c,d){var e=null,f=null,g=null;return b="inner"===b||"outer"===b?b:"",g=""===b?"height":b+"Height",c=c===!0?!0:!1,f=a(this).clone().css({position:"absolute",left:-1e4}).appendTo(d||"body"),e=c?f[g](c):f[g](),f.remove(),e},a.fn.bindMobileEvents=function(){a(this).on("touchstart touchmove touchend touchcancel",function(){var a=event.changedTouches,b=a[0],c="";switch(event.type){case"touchstart":c="mousedown";break;case"touchmove":c="mousemove",event.preventDefault();break;case"touchend":c="mouseup";break;default:return}var d=document.createEvent("MouseEvent");d.initMouseEvent(c,!0,!0,window,1,b.screenX,b.screenY,b.clientX,b.clientY,!1,!1,!1,!1,0,null),b.target.dispatchEvent(d)})}}(jQuery),window.rgbHex=function(){function a(a){return!isNaN(parseFloat(a))&&isFinite(a)}function b(a){return a.replace(/^\s+|\s+$/g,"")}function c(c){return c=b(c),a(c)&&c>=0&&255>=c}function d(a){return/^[0-9a-f]{3}$|^[0-9a-f]{6}$/i.test(b(a))}function e(a){return a=parseInt(a,10).toString(16),1===a.length?"0"+a:a}function f(a){return parseInt(a,16).toString()}function g(b){return b=b.split(","),(3===b.length||4===b.length)&&c(b[0])&&c(b[1])&&c(b[2])?4!==b.length||a(b[3])?"#"+e(b[0]).toUpperCase()+e(b[1]).toUpperCase()+e(b[2]).toUpperCase():null:null}function h(a){return d(a)?(3===a.length&&(a=a.charAt(0)+a.charAt(0)+a.charAt(1)+a.charAt(1)+a.charAt(2)+a.charAt(2)),"rgb("+f(a.substr(0,2))+","+f(a.substr(2,2))+","+f(a.substr(4,2))+")"):void 0}function i(a){return a.replace(/\s/g,"")}return function(a){if(!a)return null;var c=null,d=/^rgba?\((.*)\);?$/,e=/^#/;return a=b(a.toString()),"transparent"===a||"rgba(0,0,0,0)"===i(a)?"transparent":d.test(a)?g(a.match(d)[1]):e.test(a)?h(a.split("#").reverse()[0]):(c=a.split(","),1===c.length?h(a):3===c.length||4===c.length?g(a):void 0)}}(),jQuery&&jQuery.extend({rgbHex:function(a){return window.rgbHex(a)}}),!function(a){function b(b,c){this.$el=a(b),this.options=c,this.init=!1,this.generate()}b.prototype={generate:function(){return this.$colorPicker||(this.$noneColorPalette=this._createPalette("none",[["transparent"]]),this.$simpleColorPalette=this._createPalette("simple",a.fn.wColorPicker.simpleColors),this.$mixedColorPalette=this._createPalette("mixed",a.fn.wColorPicker.mixedColors),this.$colorTarget=a('<div class="wColorPicker-color-target"></div>'),this.$customInput=a('<input type="text" class="wColorPicker-custom-input"/>').keyup(a.proxy(this._customInputKeyup,this)),this.options.dropperButton&&(this.$dropperButton=this._createDropperButton()),this.$colorPickerPalettesHolder=a('<div class="wColorPicker-palettes-holder"></div>').append(this.$noneColorPalette).append(this.$colorTarget).append(this.$customInput).append(this.$dropperButton).append("<br/>").append(this.$simpleColorPalette).append(this.$mixedColorPalette),this.$colorPickerHolder=a('<div class="wColorPicker-holder"></div>').append(this.$colorPickerPalettesHolder),this.$colorPickerBg=a('<div class="wColorPicker-bg"></div>'),this.$colorPicker=a('<div class="wColorPicker" title=""></div>').mouseenter(function(a){a.stopPropagation()}).bind("mouseenter mousemove click",function(a){a.stopPropagation()}).append(this.$colorPickerBg).append(this.$colorPickerHolder),this.setOpacity(this.options.opacity),this.setTheme(this.options.theme),this.setColor(this.options.color),a("body").append(this.$colorPicker),this.width=this.$colorPickerPalettesHolder.width(),this.height=this.$colorPickerPalettesHolder.height(),this.$colorPickerPalettesHolder.width(this.width),this.$colorPickerPalettesHolder.height(this.height),this.$el.append(this.$colorPicker),this.setMode(this.options.mode),this.setPosition(this.options.position)),this.init=!0,this},setTheme:function(a){this.$colorPicker.attr("class",this.$colorPicker.attr("class").replace(/wColorPicker-theme-.+\s|wColorPicker-theme-.+$/,"")),this.$colorPicker.addClass("wColorPicker-theme-"+a)},setOpacity:function(a){this.$colorPickerBg.css("opacity",a)},setColor:function(a){return window.rgbHex(a)?(this.options.color=a,this.$colorTarget.css("backgroundColor",a),this.$customInput.val(a),this.init&&this.options.onSelect&&this.options.onSelect.apply(this,[a]),void 0):!0},setMode:function(b){var c=this,d=function(){c._toggleEffect("show")},e=function(){c._toggleEffect("hide")};if("flat"===b?this.$colorPicker.removeClass("wColorPicker-zindex").css({position:"relative",display:""}):this.$colorPicker.addClass("wColorPicker-zindex").css({position:"absolute"}).hide(),this.$el.find("wColorPicker-button").remove(),this.$el.unbind("mouseenter",d).unbind("mouseleave",e),a(document).unbind("click",e),"flat"!==b){var f=null,g=null,h=function(a){a.stopPropagation(),c.options.generateButton&&g.css("backgroundColor",c.options.color),c._toggleEffect()};this.options.generateButton&&(f=a('<div class="wColorPicker-button"></div>'),g=a('<div class="wColorPicker-button-color"></div>').css("backgroundColor",this.options.color),this.$el.append(f),f.append(g.height(this.$el.height()-f.outerHeight(!0)))),this.$noneColorPalette.bind("click",h),this.$simpleColorPalette.bind("click",h),this.$mixedColorPalette.bind("click",h)}"click"===b?(this.$el.click(function(a){c._toggleEffect(),a.stopPropagation()}),this.$colorPicker.click(function(a){a.stopPropagation()}),a(document).bind("click",e)):"hover"===b&&this.$el.bind("mouseenter",d).bind("mouseleave",e)},setEffect:function(a){return"flat"===this.options.mode?!0:(this.$colorPicker.css("opacity",1),this.$colorPickerHolder.width(this.width).height(this.height),"fade"===a?this.$colorPicker.css("opacity",0):"slide"===a&&this.$colorPickerHolder.width("x"===this.positionAxis?0:this.width).height("y"===this.positionAxis?0:this.height),void 0)},setPosition:function(a){if("flat"===this.options.mode)return!0;var b=this.$el.outerWidth(),c=this.$el.outerHeight(),d=this.$el.outerWidth()/2-this.$colorPicker.outerWidth()/2,e=this.$el.outerHeight()/2-this.$colorPicker.outerHeight()/2,f={left:"",right:"",top:"",bottom:""},g=this.options.position.charAt(0);switch("t"===g||"b"===g?this.positionAxis="y":("l"===g||"r"===g)&&(this.positionAxis="x"),a){case"tl":f.left=0,f.bottom=c;break;case"tc":f.left=d,f.bottom=c;break;case"tr":f.right=0,f.bottom=c;break;case"rt":f.left=b,f.top=0;break;case"rm":f.left=b,f.top=e;break;case"rb":f.left=b,f.bottom=0;break;case"br":f.right=0,f.top=c;break;case"bc":f.left=d,f.top=c;break;case"bl":f.left=0,f.top=c;break;case"lb":f.right=b,f.bottom=0;break;case"lm":f.right=b,f.top=e;break;case"lt":f.right=b,f.top=0}this.$colorPicker.css(f),this.setEffect(this.options.effect)},_createPalette:function(b,c){var d=0,e=0,f=0,g=0,h=null,i=a('<div class="wColorPicker-palette wColorPicker-palette-'+b+'"></div>');for(d=0,e=c.length;e>d;d++){for(f=0,g=c[d].length;g>f;f++)h=this._createColor(f,c[d][f]),0===d&&h.addClass("wColorPicker-palette-color-top"),0===f&&h.addClass("wColorPicker-palette-color-left"),i.append(h);e>d&&i.append("<br/>")}return i},_createColor:function(b,c){var d=this;return a('<div class="wColorPicker-palette-color"></div>').attr("id","wColorPicker-palette-color-"+b).addClass("wColorPicker-palette-color-"+b).css("backgroundColor",c).hover(function(){d._colorMouseenter(a(this))},function(){d._colorMouseleave(a(this))}).click(function(){d.setColor(window.rgbHex(a(this).css("backgroundColor")))})},_createDropperButton:function(){return a('<div class="wColorPicker-dropper"></div>').click(a.proxy(this.options.onDropper,this))},_customInputKeyup:function(b){var c=a(b.target).val();window.rgbHex(c)&&(this.$colorTarget.css("backgroundColor",c),13===b.keyCode&&this.setColor(c))},_colorMouseenter:function(a){var b=window.rgbHex(a.css("backgroundColor"));a.addClass("active").prev().addClass("active-right"),a.prevAll("."+a.attr("id")+":first").addClass("active-bottom"),this.$colorTarget.css("backgroundColor",b),this.$customInput.val(b),this.options.onMouseover&&this.options.onMouseover.apply(this,[b])},_colorMouseleave:function(a){a.removeClass("active").prev().removeClass("active-right"),a.prevAll("."+a.attr("id")+":first").removeClass("active-bottom"),this.$colorTarget.css("backgroundColor",this.options.color),this.$customInput.val(this.options.color),this.options.onMouseout&&this.options.onMouseout.apply(this,[this.options.color])},_toggleEffect:function(a){var b=this.$colorPicker.hasClass("wColorPicker-visible");(!a||"show"===a&&b===!1||"hide"===a&&b===!0)&&(b||this.setPosition(this.options.position),this["_"+this.options.effect+"Effect"+(b?"Hide":"Show")](),this.$colorPicker.toggleClass("wColorPicker-visible"))},_noneEffectShow:function(){this.$colorPicker.css("display","inline-block")},_noneEffectHide:function(){this.$colorPicker.hide()},_fadeEffectShow:function(){this.$colorPicker.stop(!0,!1).css({display:"inline-block"}).animate({opacity:1},this.options.showSpeed)},_fadeEffectHide:function(){this.$colorPicker.stop(!0,!1).animate({opacity:0},this.options.hideSpeed,a.proxy(function(){this.$colorPicker.hide()},this))},_slideEffectShow:function(){var a="y"===this.positionAxis?{height:this.height}:{width:this.width};this.$colorPicker.css("display","inline-block"),this.$colorPickerHolder.stop(!0,!1).animate(a,this.options.showSpeed)},_slideEffectHide:function(){var b="y"===this.positionAxis?{height:0}:{width:0};this.$colorPickerHolder.stop(!0,!1).animate(b,this.options.hideSpeed,a.proxy(function(){this.$colorPicker.hide()},this))}},a.fn.wColorPicker=function(c,d){function e(d){var e,f=a.data(d,"wColorPicker");return f||(e=a.extend({},a.fn.wColorPicker.defaults,c),e.color=window.rgbHex(e.color)?e.color:"transparent",f=new b(d,e),a.data(d,"wColorPicker",f)),f}if("string"==typeof c){var f=[],g=null,h=null,i=null;return h=this.each(function(){g=a(this).data("wColorPicker"),g&&(i=(d?"set":"get")+c.charAt(0).toUpperCase()+c.substring(1).toLowerCase(),g[c]?f.push(g[c].apply(g,[d])):d?(g[i]&&g[i].apply(g,[d]),g.options[c]&&(g.options[c]=d)):g[i]?f.push(g[i].apply(g,[d])):g.options[c]?f.push(g.options[c]):f.push(null))}),1===f.length?f[0]:f.length>0?f:h}return this.each(function(){e(this)})},a.fn.wColorPicker.defaults={theme:"classic",opacity:.9,color:"#FF0000",mode:"flat",position:"bl",generateButton:!0,dropperButton:!1,effect:"slide",showSpeed:500,hideSpeed:500,onMouseover:null,onMouseout:null,onSelect:null,onDropper:null},a.fn.wColorPicker.mixedColors=[["#000000","#003300","#006600","#009900","#00CC00","#00FF00","#330000","#333300","#336600","#339900","#33CC00","#33FF00","#660000","#663300","#666600","#669900","#66CC00","#66FF00"],["#000033","#003333","#006633","#009933","#00CC33","#00FF33","#330033","#333333","#336633","#339933","#33CC33","#33FF33","#660033","#663333","#666633","#669933","#66CC33","#66FF33"],["#000066","#003366","#006666","#009966","#00CC66","#00FF66","#330066","#333366","#336666","#339966","#33CC66","#33FF66","#660066","#663366","#666666","#669966","#66CC66","#66FF66"],["#000099","#003399","#006699","#009999","#00CC99","#00FF99","#330099","#333399","#336699","#339999","#33CC99","#33FF99","#660099","#663399","#666699","#669999","#66CC99","#66FF99"],["#0000CC","#0033CC","#0066CC","#0099CC","#00CCCC","#00FFCC","#3300CC","#3333CC","#3366CC","#3399CC","#33CCCC","#33FFCC","#6600CC","#6633CC","#6666CC","#6699CC","#66CCCC","#66FFCC"],["#0000FF","#0033FF","#0066FF","#0099FF","#00CCFF","#00FFFF","#3300FF","#3333FF","#3366FF","#3399FF","#33CCFF","#33FFFF","#6600FF","#6633FF","#6666FF","#6699FF","#66CCFF","#66FFFF"],["#990000","#993300","#996600","#999900","#99CC00","#99FF00","#CC0000","#CC3300","#CC6600","#CC9900","#CCCC00","#CCFF00","#FF0000","#FF3300","#FF6600","#FF9900","#FFCC00","#FFFF00"],["#990033","#993333","#996633","#999933","#99CC33","#99FF33","#CC0033","#CC3333","#CC6633","#CC9933","#CCCC33","#CCFF33","#FF0033","#FF3333","#FF6633","#FF9933","#FFCC33","#FFFF33"],["#990066","#993366","#996666","#999966","#99CC66","#99FF66","#CC0066","#CC3366","#CC6666","#CC9966","#CCCC66","#CCFF66","#FF0066","#FF3366","#FF6666","#FF9966","#FFCC66","#FFFF66"],["#990099","#993399","#996699","#999999","#99CC99","#99FF99","#CC0099","#CC3399","#CC6699","#CC9999","#CCCC99","#CCFF99","#FF0099","#FF3399","#FF6699","#FF9999","#FFCC99","#FFFF99"],["#9900CC","#9933CC","#9966CC","#9999CC","#99CCCC","#99FFCC","#CC00CC","#CC33CC","#CC66CC","#CC99CC","#CCCCCC","#CCFFCC","#FF00CC","#FF33CC","#FF66CC","#FF99CC","#FFCCCC","#FFFFCC"],["#9900FF","#9933FF","#9966FF","#9999FF","#99CCFF","#99FFFF","#CC00FF","#CC33FF","#CC66FF","#CC99FF","#CCCCFF","#CCFFFF","#FF00FF","#FF33FF","#FF66FF","#FF99FF","#FFCCFF","#FFFFFF"]],a.fn.wColorPicker.simpleColors=[["#000000"],["#333333"],["#666666"],["#999999"],["#CCCCCC"],["#FFFFFF"],["#FF0000"],["#00FF00"],["#0000FF"],["#FFFF00"],["#00FFFF"],["#FF00FF"]]
}(jQuery),!function(a){a.fn.wPaint.menus.main={img:"plugins/main/img/icons-menu-main.png",items:{undo:{icon:"generic",title:"Undo",index:0,callback:function(){this.undo()}},redo:{icon:"generic",title:"Redo",index:1,callback:function(){this.redo()}},clear:{icon:"generic",title:"Clear",index:2,callback:function(){this.clear()}},rectangle:{icon:"activate",title:"Rectangle",index:3,callback:function(){this.setMode("rectangle")}},ellipse:{icon:"activate",title:"Ellipse",index:4,callback:function(){this.setMode("ellipse")}},line:{icon:"activate",title:"Line",index:5,callback:function(){this.setMode("line")}},pencil:{icon:"activate",title:"Pencil",index:6,callback:function(){this.setMode("pencil")}},eraser:{icon:"activate",title:"Eraser",index:8,callback:function(){this.setMode("eraser")}},bucket:{icon:"activate",title:"Bucket",index:9,callback:function(){this.setMode("bucket")}},fillStyle:{title:"Fill Color",icon:"colorPicker",callback:function(a){this.setFillStyle(a)}},lineWidth:{icon:"select",title:"Stroke Width",range:[1,2,3,4,5,6,7,8,9,10],value:2,callback:function(a){this.setLineWidth(a)}},strokeStyle:{icon:"colorPicker",title:"Stroke Color",callback:function(a){this.setStrokeStyle(a)}}}},a.extend(a.fn.wPaint.cursors,{"default":{path:"plugins/main/img/cursor-crosshair.png",left:7,top:7},dropper:{path:"plugins/main/img/cursor-dropper.png",left:0,top:12},pencil:{path:"plugins/main/img/cursor-pencil.png",left:0,top:11.99},bucket:{path:"plugins/main/img/cursor-bucket.png",left:0,top:10},eraser1:{path:"plugins/main/img/cursor-eraser1.png",left:1,top:1},eraser2:{path:"plugins/main/img/cursor-eraser2.png",left:2,top:2},eraser3:{path:"plugins/main/img/cursor-eraser3.png",left:2,top:2},eraser4:{path:"plugins/main/img/cursor-eraser4.png",left:3,top:3},eraser5:{path:"plugins/main/img/cursor-eraser5.png",left:3,top:3},eraser6:{path:"plugins/main/img/cursor-eraser6.png",left:4,top:4},eraser7:{path:"plugins/main/img/cursor-eraser7.png",left:4,top:4},eraser8:{path:"plugins/main/img/cursor-eraser8.png",left:5,top:5},eraser9:{path:"plugins/main/img/cursor-eraser9.png",left:5,top:5},eraser10:{path:"plugins/main/img/cursor-eraser10.png",left:6,top:6}}),a.extend(a.fn.wPaint.defaults,{mode:"pencil",lineWidth:"3",fillStyle:"#FFFFFF",strokeStyle:"#FFFF00"}),a.fn.wPaint.extend({undoCurrent:-1,undoArray:[],setUndoFlag:!0,generate:function(){this.menus.all.main=this._createMenu("main",{offsetLeft:this.options.menuOffsetLeft,offsetTop:this.options.menuOffsetTop})},_init:function(){this._addUndo(),this.menus.all.main._setIconDisabled("clear",!0)},setStrokeStyle:function(a){this.options.strokeStyle=a,this.menus.all.main._setColorPickerValue("strokeStyle",a)},setLineWidth:function(a){this.options.lineWidth=a,this.menus.all.main._setSelectValue("lineWidth",a),this.setCursor(this.options.mode)},setFillStyle:function(a){this.options.fillStyle=a,this.menus.all.main._setColorPickerValue("fillStyle",a)},setCursor:function(a){"eraser"===a&&this.setCursor("eraser"+this.options.lineWidth)},undo:function(){this.undoArray[this.undoCurrent-1]&&this._setUndo(--this.undoCurrent),this._undoToggleIcons()},redo:function(){this.undoArray[this.undoCurrent+1]&&this._setUndo(++this.undoCurrent),this._undoToggleIcons()},_addUndo:function(){for(this.undoCurrent<this.undoArray.length-1?this.undoArray[++this.undoCurrent]=this.getImage(!1):(this.undoArray.push(this.getImage(!1)),this.undoArray.length>this.undoMax?this.undoArray=this.undoArray.slice(1,this.undoArray.length):this.undoCurrent++);this.undoCurrent!==this.undoArray.length-1;)this.undoArray.pop();this._undoToggleIcons(),this.menus.all.main._setIconDisabled("clear",!1)},_undoToggleIcons:function(){var a=this.undoCurrent>0&&this.undoArray.length>1?0:1,b=this.undoCurrent<this.undoArray.length-1?2:3;this.menus.all.main._setIconDisabled("undo",1===a?!0:!1),this.menus.all.main._setIconDisabled("redo",3===b?!0:!1)},_setUndo:function(a){this.setUndoFlag=!1,this.setImage(this.undoArray[a])},_imageOnload:function(){this.setUndoFlag&&this._addUndo(),this.setUndoFlag=!0},clear:function(){this.menus.all.main._isIconDisabled("clear")||(this.ctx.clearRect(0,0,this.width,this.height),this._addUndo(),this.menus.all.main._setIconDisabled("clear",!0))},_drawRectangleDown:function(a){this._drawShapeDown(a)},_drawRectangleMove:function(a){this._drawShapeMove(a),this.ctxTemp.rect(a.x,a.y,a.w,a.h),this.ctxTemp.stroke(),this.ctxTemp.fill()},_drawRectangleUp:function(a){this._drawShapeUp(a),this._addUndo()},_drawEllipseDown:function(a){this._drawShapeDown(a)},_drawEllipseMove:function(a){this._drawShapeMove(a),this.ctxTemp.ellipse(a.x,a.y,a.w,a.h),this.ctxTemp.stroke(),this.ctxTemp.fill()},_drawEllipseUp:function(a){this._drawShapeUp(a),this._addUndo()},_drawLineDown:function(a){this._drawShapeDown(a)},_drawLineMove:function(a){this._drawShapeMove(a,1);var b=this.canvasTempLeftOriginal,c=this.canvasTempTopOriginal;a.pageX<b&&(a.x=a.x+a.w,a.w=-1*a.w),a.pageY<c&&(a.y=a.y+a.h,a.h=-1*a.h),this.ctxTemp.lineJoin="round",this.ctxTemp.beginPath(),this.ctxTemp.moveTo(a.x,a.y),this.ctxTemp.lineTo(a.x+a.w,a.y+a.h),this.ctxTemp.closePath(),this.ctxTemp.stroke()},_drawLineUp:function(a){this._drawShapeUp(a),this._addUndo()},_drawPencilDown:function(a){this.ctx.lineJoin="round",this.ctx.lineCap="round",this.ctx.strokeStyle=this.options.strokeStyle,this.ctx.fillStyle=this.options.strokeStyle,this.ctx.lineWidth=this.options.lineWidth,this.ctx.beginPath(),this.ctx.arc(a.pageX,a.pageY,this.options.lineWidth/2,0,2*Math.PI,!0),this.ctx.closePath(),this.ctx.fill(),this.ctx.beginPath(),this.ctx.moveTo(a.pageX,a.pageY)},_drawPencilMove:function(a){this.ctx.lineTo(a.pageX,a.pageY),this.ctx.stroke()},_drawPencilUp:function(){this.ctx.closePath(),this._addUndo()},_drawEraserDown:function(a){this.ctx.save(),this.ctx.globalCompositeOperation="destination-out",this._drawPencilDown(a)},_drawEraserMove:function(a){this._drawPencilMove(a)},_drawEraserUp:function(a){this._drawPencilUp(a),this.ctx.restore()},_drawBucketDown:function(a){this.ctx.fillArea(a.pageX,a.pageY,this.options.fillStyle),this._addUndo()}})}(jQuery),!function(){window.CanvasRenderingContext2D&&(CanvasRenderingContext2D.prototype.fillArea=function(a,b,c){function d(a){return{r:p[a],g:p[a+1],b:p[a+2],a:p[a+3]}}function e(a){p[a]=c.r,p[a+1]=c.g,p[a+2]=c.b,p[a+3]=c.a}function f(a){return g.r===a.r&&g.g===a.g&&g.b===a.b&&g.a===a.a}if(!a||!b||!c)return!0;var g,h,i,j,k,l,m=this.canvas.width,n=this.canvas.height,o=this.getImageData(0,0,m,n),p=o.data,q=[[a,b]];if(g=d(4*(b*m+a)),l=this.canvas.style.color,this.canvas.style.color=c,c=this.canvas.style.color.match(/^rgba?\((.*)\);?$/)[1].split(","),this.canvas.style.color=l,c={r:parseInt(c[0],10),g:parseInt(c[1],10),b:parseInt(c[2],10),a:parseInt(c[3]||255,10)},f(c))return!0;for(;q.length;){for(h=q.pop(),i=4*(h[1]*m+h[0]);h[1]-->=0&&f(d(i));)i-=4*m;for(i+=4*m,++h[1],j=!1,k=!1;h[1]++<n-1&&f(d(i));)e(i),h[0]>0&&(f(d(i-4))?j||(q.push([h[0]-1,h[1]]),j=!0):j&&(j=!1)),h[0]<m-1&&(f(d(i+4))?k||(q.push([h[0]+1,h[1]]),k=!0):k&&(k=!1)),i+=4*m}this.putImageData(o,0,0)})}(),!function(a){a.fn.wPaint.menus.text={img:"plugins/text/img/icons-menu-text.png",items:{bold:{icon:"toggle",title:"Bold",index:0,callback:function(a){this.setFontBold(a)}},italic:{icon:"toggle",title:"Italic",index:1,callback:function(a){this.setFontItalic(a)}},fontSize:{title:"Font Size",icon:"select",range:[8,9,10,12,14,16,20,24,30],value:12,callback:function(a){this.setFontSize(a)}},fontFamily:{icon:"select",title:"Font Family",range:["Arial","Courier","Times","Verdana"],useRange:!0,value:"Arial",callback:function(a){this.setFontFamily(a)}}}},a.fn.wPaint.menus.main.items.text={icon:"menu",after:"pencil",title:"Text",index:7,callback:function(){this.setMode("text")}},a.extend(a.fn.wPaint.defaults,{fontSize:"12",fontFamily:"Arial",fontBold:!1,fontItalic:!1,fontUnderline:!1}),a.fn.wPaint.extend({generate:function(){this.$textCalc=a("<div></div>").hide(),this.$textInput=a('<textarea class="wPaint-text-input" spellcheck="false"></textarea>').on("mousedown",this._stopPropagation).css({position:"absolute"}).hide(),a("body").append(this.$textCalc),this.$el.append(this.$textInput),this.menus.all.text=this._createMenu("text")},_init:function(){function b(){c._drawTextIfNotEmpty(),c.$textInput.hide(),c.$canvasTemp.hide()}var c=this;for(var d in this.menus.all)this.menus.all[d].$menu.on("click",b).on("mousedown",this._stopPropagation);a(document).on("mousedown",b)},setFillStyle:function(a){this.$textInput.css("color",a)},setFontSize:function(a){this.options.fontSize=parseInt(a,10),this._setFont({fontSize:a+"px",lineHeight:a+"px"}),this.menus.all.text._setSelectValue("fontSize",a)},setFontFamily:function(a){this.options.fontFamily=a,this._setFont({fontFamily:a}),this.menus.all.text._setSelectValue("fontFamily",a)},setFontBold:function(a){this.options.fontBold=a,this._setFont({fontWeight:a?"bold":""})},setFontItalic:function(a){this.options.fontItalic=a,this._setFont({fontStyle:a?"italic":""})},setFontUnderline:function(a){this.options.fontUnderline=a,this._setFont({fontWeight:a?"underline":""})},_setFont:function(a){this.$textInput.css(a),this.$textCalc.css(a)},_drawTextDown:function(a){this._drawTextIfNotEmpty(),this._drawShapeDown(a,1),this.$textInput.css({left:a.pageX-1,top:a.pageY-1,width:0,height:0}).show().focus()},_drawTextMove:function(a){this._drawShapeMove(a,1),this.$textInput.css({left:a.left-1,top:a.top-1,width:a.width,height:a.height})},_drawTextIfNotEmpty:function(){""!==this.$textInput.val()&&this._drawText()},_drawText:function(){var a,b,c,d,e="",f=this.$textInput.val().split("\n"),g=[],h=this.$textInput.width()-2,i=0,j=0,k=this.$textInput.position(),l=k.left+1,m=k.top+1;for(this.options.fontItalic&&(e+="italic "),this.options.fontBold&&(e+="bold "),e+=this.options.fontSize+"px "+this.options.fontFamily,a=0,b=f.length;b>a;a++){for(this.$textCalc.html(""),j=0,c=0,d=f[0].length;d>c;c++)i=this.$textCalc.append(f[a][c]).width(),i>h&&(g.push(f[a].substring(j,c)),j=c,this.$textCalc.html(f[a][c]));j!==c&&g.push(f[a].substring(j,c))}for(f=this.$textInput.val(g.join("\n")).val().split("\n"),a=0,b=f.length;b>a;a++)this.ctx.fillStyle=this.options.fillStyle,this.ctx.textBaseline="top",this.ctx.font=e,this.ctx.fillText(f[a],l,m),m+=this.options.fontSize;this.$textInput.val(""),this._addUndo()}})}(jQuery),!function(a){var b="plugins/shapes/img/icons-menu-main-shapes.png";a.extend(!0,a.fn.wPaint.menus.main.items,{rectangle:{group:"shapes"},roundedRect:{icon:"activate",group:"shapes",title:"Rounded Rectangle",img:b,index:0,callback:function(){this.setMode("roundedRect")}},square:{icon:"activate",group:"shapes",title:"Square",img:b,index:1,callback:function(){this.setMode("square")}},roundedSquare:{icon:"activate",group:"shapes",title:"Rounded Square",img:b,index:2,callback:function(){this.setMode("roundedSquare")}},diamond:{icon:"activate",group:"shapes",title:"Diamond",img:b,index:4,callback:function(){this.setMode("diamond")}},ellipse:{group:"shapes2"},circle:{icon:"activate",group:"shapes2",title:"Circle",img:b,index:3,callback:function(){this.setMode("circle")}},pentagon:{icon:"activate",group:"shapes2",title:"Pentagon",img:b,index:5,callback:function(){this.setMode("pentagon")}},hexagon:{icon:"activate",group:"shapes2",title:"Hexagon",img:b,index:6,callback:function(){this.setMode("hexagon")}}}),a.fn.wPaint.extend({_drawRoundedRectDown:function(a){this._drawShapeDown(a)},_drawRoundedRectMove:function(a){this._drawShapeMove(a);var b=a.w>a.h?a.h/a.w:a.w/a.h;this.ctxTemp.roundedRect(a.x,a.y,a.w,a.h,Math.ceil(.001*b*a.w*a.h)),this.ctxTemp.stroke(),this.ctxTemp.fill()},_drawRoundedRectUp:function(a){this._drawShapeUp(a),this._addUndo()},_drawSquareDown:function(a){this._drawShapeDown(a)},_drawSquareMove:function(a){this._drawShapeMove(a);var b=a.w>a.h?a.h:a.w;this.ctxTemp.rect(a.x,a.y,b,b),this.ctxTemp.stroke(),this.ctxTemp.fill()},_drawSquareUp:function(a){this._drawShapeUp(a),this._addUndo()},_drawRoundedSquareDown:function(a){this._drawShapeDown(a)},_drawRoundedSquareMove:function(a){this._drawShapeMove(a);var b=a.w>a.h?a.h:a.w;this.ctxTemp.roundedRect(a.x,a.y,b,b,Math.ceil(.001*b*b)),this.ctxTemp.stroke(),this.ctxTemp.fill()},_drawRoundedSquareUp:function(a){this._drawShapeUp(a),this._addUndo()},_drawDiamondDown:function(a){this._drawShapeDown(a)},_drawDiamondMove:function(a){this._drawShapeMove(a),this.ctxTemp.diamond(a.x,a.y,a.w,a.h),this.ctxTemp.stroke(),this.ctxTemp.fill()},_drawDiamondUp:function(a){this._drawShapeUp(a),this._addUndo()},_drawCircleDown:function(a){this._drawShapeDown(a)},_drawCircleMove:function(a){this._drawShapeMove(a);var b=a.w>a.h?a.h:a.w;this.ctxTemp.ellipse(a.x,a.y,b,b),this.ctxTemp.stroke(),this.ctxTemp.fill()},_drawCircleUp:function(a){this._drawShapeUp(a),this._addUndo()},_drawPentagonDown:function(a){this._drawShapeDown(a)},_drawPentagonMove:function(a){this._drawShapeMove(a),this.ctxTemp.pentagon(a.x,a.y,a.w,a.h),this.ctxTemp.stroke(),this.ctxTemp.fill()},_drawPentagonUp:function(a){this._drawShapeUp(a),this._addUndo()},_drawHexagonDown:function(a){this._drawShapeDown(a)},_drawHexagonMove:function(a){this._drawShapeMove(a),this.ctxTemp.hexagon(a.x,a.y,a.w,a.h),this.ctxTemp.stroke(),this.ctxTemp.fill()},_drawHexagonUp:function(a){this._drawShapeUp(a),this._addUndo()}})}(jQuery),!function(){window.CanvasRenderingContext2D&&(CanvasRenderingContext2D.prototype.diamond=function(a,b,c,d){return a&&b&&c&&d?(this.beginPath(),this.moveTo(a+.5*c,b),this.lineTo(a,b+.5*d),this.lineTo(a+.5*c,b+d),this.lineTo(a+c,b+.5*d),this.lineTo(a+.5*c,b),this.closePath(),void 0):!0}),window.CanvasRenderingContext2D&&(CanvasRenderingContext2D.prototype.ellipse=function(a,b,c,d){if(!(a&&b&&c&&d))return!0;var e=.5522848,f=c/2*e,g=d/2*e,h=a+c,i=b+d,j=a+c/2,k=b+d/2;this.beginPath(),this.moveTo(a,k),this.bezierCurveTo(a,k-g,j-f,b,j,b),this.bezierCurveTo(j+f,b,h,k-g,h,k),this.bezierCurveTo(h,k+g,j+f,i,j,i),this.bezierCurveTo(j-f,i,a,k+g,a,k),this.closePath()}),window.CanvasRenderingContext2D&&(CanvasRenderingContext2D.prototype.hexagon=function(a,b,c,d){if(!(a&&b&&c&&d))return!0;var e=.225,f=1-e;this.beginPath(),this.moveTo(a+.5*c,b),this.lineTo(a,b+d*e),this.lineTo(a,b+d*f),this.lineTo(a+.5*c,b+d),this.lineTo(a+c,b+d*f),this.lineTo(a+c,b+d*e),this.lineTo(a+.5*c,b),this.closePath()}),window.CanvasRenderingContext2D&&(CanvasRenderingContext2D.prototype.pentagon=function(a,b,c,d){return a&&b&&c&&d?(this.beginPath(),this.moveTo(a+c/2,b),this.lineTo(a,b+.4*d),this.lineTo(a+.2*c,b+d),this.lineTo(a+.8*c,b+d),this.lineTo(a+c,b+.4*d),this.lineTo(a+c/2,b),this.closePath(),void 0):!0}),window.CanvasRenderingContext2D&&(CanvasRenderingContext2D.prototype.roundedRect=function(a,b,c,d,e){return a&&b&&c&&d?(e||(e=5),this.beginPath(),this.moveTo(a+e,b),this.lineTo(a+c-e,b),this.quadraticCurveTo(a+c,b,a+c,b+e),this.lineTo(a+c,b+d-e),this.quadraticCurveTo(a+c,b+d,a+c-e,b+d),this.lineTo(a+e,b+d),this.quadraticCurveTo(a,b+d,a,b+d-e),this.lineTo(a,b+e),this.quadraticCurveTo(a,b,a+e,b),this.closePath(),void 0):!0})}(),function(a){a.fn.sgKnob=function(b,c){return this.each(function(){var d=a(this),e=b.get(d.data("prop")),f=d.data("scale")||1,g=d.data("step")||1,h=d.data("min")||1,i=d.data("max")||100;d.bind("change",function(){e.set(parseInt(d.val(),10)/f)}),d.val(e.get()*f),d.knob({width:d.width(),height:d.height(),fgColor:d.css("color"),inputColor:d.css("color"),thickness:.3,bgColor:d.css("backgroundColor"),displayPrevious:!0,step:g,min:h,max:i,change:function(a){console.log("val",a);var b=Math.floor(a-a%g)/f;e.set(b),c.sendOnce("change","knob",e.name)}}),e.addChangeListener(function(a){d.val(a*f),d.trigger("change")})})},a.fn.sgGrid=function(b,c){var d=a(this)[0],e=d.getContext("2d");e.fillStyle="rgba(0,0,0,0.2)";var f=d.width,g=d.height;e.clearRect(0,0,f,g);for(var h=0;f>h;h+=b)e.fillRect(h,0,1,g);for(var i=0;g>i;i+=c)e.fillRect(0,parseInt(i,10),f,1)},a.fn.sgGridLabels=function(b,c){var d=a(this)[0],e=d.height,f=d.getContext("2d");f.fillStyle=this.css("color"),f.font=this.css("font-size")+" Calibri",f.clearRect(0,0,d.width,e);for(var g=b/2;g<d.height;g+=b){var h=c(g);f.fillText(h,2,g+3)}},a.fn.bindMobileEventsPreventMouse=function(){a(this).on("touchstart touchmove touchend touchcancel",function(a){var b=a.originalEvent,c=b.changedTouches,d=c[0],e="";switch(b.type){case"touchstart":e="mousedown",b.preventDefault();break;case"touchmove":e="mousemove",b.preventDefault();break;case"touchend":e="mouseup",b.preventDefault();break;default:return}var f=document.createEvent("MouseEvent");f.initMouseEvent(e,!0,!0,window,1,d.screenX,d.screenY,d.clientX,d.clientY,!1,!1,!1,!1,0,null),d.target.dispatchEvent(f)})},a.fn.sgTab=function(b){return this.each(function(){var c=a(this),d=c.children(".sidecontent");c.on("click",".tab-label",function(){var e=a(this).data("tab-selector"),f=a(e);d.not(f).hide(),a(".tab-label",c).removeClass("selected"),a(this).addClass("selected"),f.show(),b.send("click","tab",e)})})},a.fn.sgButton=function(b,c){return this.each(function(){var d=a(this),e=b.get(d.data("prop")),f=d.data("onclass")+"/"+d.data("offclass"),g=function(){var a=e.get();d.addClass(d.data(a?"onclass":"offclass")),d.removeClass(d.data(a?"offclass":"onclass"))};e.addChangeListener(function(){g()}),d.on("click",function(){e.set(!e.get()),c.send("click","button",f)}),g()})},a.fn.sgButtonSet=function(b,c){return this.each(function(){var d=a(this),e=b.get(d.data("prop")),f=d.data("allowNone")||!1;d.children("li").on("click",function(){var b=a(this).data("val");return f&&b===e.get()&&(b=""),e.set(b),c.send("click","buttonset",b),!1});var g=function(){var b=e.get();a(".selected",d).removeClass("selected"),a('li[data-val="'+b+'"] label',d).addClass("selected")};e.addChangeListener(g),g()})},a.fn.sgSlider=function(b,c){return this.each(function(){var d=a(this),e=b.get(d.data("prop")),f=Number(d.data("scale"))||1,g=d.width()-4,h=Number(d.data("max"))||g,i=Number(d.data("min"))||0,j=h-i,k=Number(a(".slider-handle",d).width())/2,l=function(){var b=Math.floor(e.get()*f),c=(b-i)/j*g;a(".fill",d).css("width",c),a(".slider-handle",d).css("left",c),a(".balloon",d).text(b)};e.addChangeListener(l);var m=function(a){var b=a.pageX-d.offset().left-k;b=Math.min(b,g);var c=b/g*j+i;c=Math.max(c,i),c=Math.min(c,h),e.set(Math.floor(c)/f)},n=!1;d.bind("mousedown",function(a){n=!0,m(a),c.sendOnce("change","slider",e.name)}),d.bind("mouseup",function(){n=!1}),d.bind("mousemove",function(a){n&&m(a)}),d.bindMobileEvents(),l()})}}(jQuery),function(a){a.fn.wPaint.menus.main.items.note={icon:"activate",title:"Note",img:"../../css/note-icon.png",index:0,callback:function(){this.setMode("Note")}},a.extend(a.fn.wPaint.defaults,{snapGridVertical:5,snapGridHorizontal:10}),a.fn.wPaint.extend({_drawNoteDown:function(a){var b=this.options.snapGridHorizontal,c=this.options.snapGridVertical,d=a.pageX-a.pageX%b,e=a.pageY-a.pageY%c,f=Math.floor(e+c-Math.floor(e));this.ctx.strokeStyle=this.options.strokeStyle,this.ctx.fillStyle=this.options.strokeStyle,this.ctx.fillRect(Math.floor(d),Math.floor(e),Math.floor(b),f)},_drawNoteMove:function(a){this._drawNoteDown(a)},_drawNoteUp:function(){this._addUndo()},paintAtCoordinatesDown:function(a){this.ctx.lineJoin="round",this.ctx.lineCap="round",this.ctx.strokeStyle=this.options.strokeStyle,this.ctx.fillStyle=this.options.strokeStyle,this.ctx.lineWidth=a.size,this.ctx.beginPath(),this.ctx.arc(a.x,a.y,a.size/2,0,2*Math.PI,!0),this.ctx.closePath(),this.ctx.fill(),this.ctx.beginPath(),this.ctx.moveTo(a.x,a.y)},paintAtCoordinatesMove:function(a){this.ctx.lineWidth=a.size,this.ctx.lineTo(a.x,a.y),this.ctx.stroke(),this.ctx.closePath(),this.ctx.fill(),this.ctx.beginPath(),this.ctx.moveTo(a.x,a.y)},paintAtCoordinatesUp:function(){this.ctx.closePath(),this._addUndo()}})}(jQuery),window.sgResources={defaultImage:"data:image/png;base64,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"};